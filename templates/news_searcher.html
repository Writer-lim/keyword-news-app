<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>통합 뉴스/미디어 검색기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8fafc; /* Blue Gray 50 */
        }
        .container {
            max-width: 1200px;
        }
        .result-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .result-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
        }
        .loading-animation {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <!-- Header & Navigation -->
    <header class="container mx-auto py-4 flex justify-between items-center border-b border-gray-200 mb-8">
        <h1 class="text-3xl font-extrabold text-gray-900">
            <i class="fas fa-search text-indigo-500 mr-2"></i> 통합 미디어 검색기
        </h1>
        <a href="/game/tictactoe" class="bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-full shadow-md transition-colors transform hover:scale-105 active:scale-95">
            <i class="fas fa-gamepad mr-2"></i> 틱택토 게임하기
        </a>
    </header>

    <!-- Main Search Area -->
    <main class="container mx-auto">
        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg mb-10">
            <div class="flex flex-col sm:flex-row gap-4">
                <input type="text" id="search-input" placeholder="검색할 키워드를 입력하세요 (예: 제미나이)" 
                       class="flex-grow p-3 border-2 border-indigo-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-lg">
                <button onclick="performSearch()" id="search-button"
                        class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-colors flex items-center justify-center disabled:opacity-50">
                    <i class="fas fa-bolt mr-2"></i> 통합 검색 실행
                </button>
            </div>
            <div id="loading-indicator" class="hidden mt-4 text-center">
                <div class="loading-animation mx-auto"></div>
                <p class="text-indigo-500 mt-2">검색 중...</p>
            </div>
        </div>

        <!-- Results Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- News Results Column -->
            <div class="space-y-4">
                <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-red-500 pb-2 flex items-center">
                    <i class="fas fa-newspaper text-red-500 mr-2"></i> 네이버 뉴스
                </h2>
                <div id="news-results" class="space-y-4">
                    <p class="text-gray-500 italic">검색 결과가 여기에 표시됩니다.</p>
                </div>
            </div>

            <!-- Image Results Column -->
            <div class="space-y-4">
                <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-green-500 pb-2 flex items-center">
                    <i class="fas fa-image text-green-500 mr-2"></i> 네이버 이미지
                </h2>
                <div id="image-results" class="grid grid-cols-2 gap-4">
                    <p class="col-span-2 text-gray-500 italic">검색 결과가 여기에 표시됩니다.</p>
                </div>
            </div>

            <!-- YouTube Results Column -->
            <div class="space-y-4">
                <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2 flex items-center">
                    <i class="fab fa-youtube text-blue-500 mr-2"></i> 유튜브 영상
                </h2>
                <div id="youtube-results" class="space-y-4">
                    <p class="text-gray-500 italic">검색 결과가 여기에 표시됩니다.</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        // DOM 요소 참조
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const loadingIndicator = document.getElementById('loading-indicator');
        const newsResultsDiv = document.getElementById('news-results');
        const imageResultsDiv = document.getElementById('image-results');
        const youtubeResultsDiv = document.getElementById('youtube-results');

        // HTML 엔티티 디코딩 함수
        function decodeHTMLEntities(str) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(str, 'text/html');
            return doc.body.textContent;
        }

        // 검색 버튼 및 Enter 키 이벤트 리스너
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        // UI 상태 관리 함수
        function setUIState(isLoading) {
            searchButton.disabled = isLoading;
            loadingIndicator.classList.toggle('hidden', !isLoading);
            searchButton.classList.toggle('bg-indigo-600', !isLoading);
            searchButton.classList.toggle('bg-gray-400', isLoading);
            searchButton.innerHTML = isLoading ? '<div class="loading-animation"></div>' : '<i class="fas fa-bolt mr-2"></i> 통합 검색 실행';
        }

        // 결과 영역 초기화 함수
        function clearResults() {
            newsResultsDiv.innerHTML = '<p class="text-gray-500 italic">검색 결과가 여기에 표시됩니다.</p>';
            imageResultsDiv.innerHTML = '<p class="col-span-2 text-gray-500 italic">검색 결과가 여기에 표시됩니다.</p>';
            youtubeResultsDiv.innerHTML = '<p class="text-gray-500 italic">검색 결과가 여기에 표시됩니다.</p>';
        }

        // --- 렌더링 함수 ---
        function renderNews(item) {
            const title = decodeHTMLEntities(item.title);
            const description = decodeHTMLEntities(item.description);
            return `
                <a href="${item.link}" target="_blank" class="result-card block p-4 bg-white border border-gray-100 rounded-lg shadow-sm hover:border-red-500 transition-all">
                    <h3 class="font-bold text-base mb-1 text-gray-900 line-clamp-2">${title}</h3>
                    <p class="text-sm text-gray-500 line-clamp-3">${description}</p>
                    <span class="text-xs text-red-600 mt-2 block">${item.pubDate ? new Date(item.pubDate).toLocaleDateString('ko-KR') : item.publisher}</span>
                </a>
            `;
        }

        function renderImage(item) {
            // 네이버 이미지 API는 실제 썸네일 URL을 제공합니다.
            return `
                <div class="result-card bg-white rounded-lg overflow-hidden shadow-sm border border-gray-100 hover:border-green-500 transition-all">
                    <a href="${item.link}" target="_blank" class="block">
                        <img src="${item.thumbnail}" alt="${decodeHTMLEntities(item.title)}" 
                             class="w-full h-32 object-cover" 
                             onerror="this.onerror=null; this.src='https://placehold.co/150x150/e0f2f7/065f46?text=No+Image'"
                        >
                        <div class="p-2">
                            <p class="text-xs text-gray-600 line-clamp-1">${decodeHTMLEntities(item.title)}</p>
                        </div>
                    </a>
                </div>
            `;
        }

        function renderYoutube(item) {
            const videoId = item.id.videoId;
            const title = item.snippet.title;
            const thumbnailUrl = item.snippet.thumbnails.medium.url;

            return `
                <a href="https://www.youtube.com/watch?v=${videoId}" target="_blank" class="result-card block bg-white border border-gray-100 rounded-lg shadow-sm hover:border-blue-500 transition-all overflow-hidden">
                    <img src="${thumbnailUrl}" alt="${title}" class="w-full object-cover h-40">
                    <div class="p-3">
                        <h3 class="font-bold text-sm text-gray-900 line-clamp-2">${title}</h3>
                        <p class="text-xs text-gray-500 mt-1 line-clamp-1">채널: ${item.snippet.channelTitle}</p>
                    </div>
                </a>
            `;
        }

        // --- 메인 검색 로직 ---
        async function fetchAPI(endpoint, query) {
            const url = `${endpoint}?query=${encodeURIComponent(query)}`;
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`API error at ${endpoint}: ${response.statusText}`);
            }
            return await response.json();
        }

        async function performSearch() {
            const query = searchInput.value.trim();
            if (!query) {
                alert('검색 키워드를 입력해 주세요.');
                return;
            }

            clearResults();
            setUIState(true);

            // 네 개의 API 호출을 동시에 실행
            const promises = [
                fetchAPI('/api/search_news', query),
                fetchAPI('/api/search_image', query),
                fetchAPI('/api/search_youtube', query)
            ];

            try {
                const [newsData, imageData, youtubeData] = await Promise.all(promises);

                // 뉴스 렌더링
                if (newsData.items && newsData.items.length > 0) {
                    newsResultsDiv.innerHTML = newsData.items.map(renderNews).join('');
                } else {
                    newsResultsDiv.innerHTML = '<p class="text-gray-500 italic p-2">검색 결과가 없습니다.</p>';
                }
                
                // 이미지 렌더링
                if (imageData.items && imageData.items.length > 0) {
                    imageResultsDiv.innerHTML = imageData.items.map(renderImage).join('');
                } else {
                    imageResultsDiv.innerHTML = '<p class="col-span-2 text-gray-500 italic p-2">검색 결과가 없습니다.</p>';
                }

                // 유튜브 렌더링
                if (youtubeData.items && youtubeData.items.length > 0) {
                    youtubeResultsDiv.innerHTML = youtubeData.items.map(renderYoutube).join('');
                } else {
                    youtubeResultsDiv.innerHTML = '<p class="text-gray-500 italic p-2">검색 결과가 없습니다.</p>';
                }

            } catch (error) {
                console.error("통합 검색 중 오류 발생:", error);
                alert('검색 중 오류가 발생했습니다. 콘솔을 확인해 주세요.');
                
                // 오류 메시지 표시
                newsResultsDiv.innerHTML = '<p class="text-red-500 italic p-2">뉴스 검색 오류</p>';
                imageResultsDiv.innerHTML = '<p class="col-span-2 text-red-500 italic p-2">이미지 검색 오류</p>';
                youtubeResultsDiv.innerHTML = '<p class="text-red-500 italic p-2">유튜브 검색 오류</p>';
            } finally {
                setUIState(false);
            }
        }
    </script>
</body>
</html>