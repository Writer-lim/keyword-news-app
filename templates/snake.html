<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë±€ ê²Œì„ (Snake Game)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap');
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f0f4f8;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        /* ê²Œì„ ë³´ë“œ ìŠ¤íƒ€ì¼ */
        #game-board {
            display: grid;
            border: 4px solid #334155;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            background-color: #1e293b; /* Slate-800 ë°°ê²½ */
            margin: 0 auto;
        }

        /* ì…€ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .cell {
            width: 20px;
            height: 20px;
            box-sizing: border-box;
        }

        /* ë±€ ìŠ¤íƒ€ì¼ */
        .snake-head {
            background-color: #10b981; /* Emerald-500 */
            border: 1px solid #059669;
            border-radius: 4px;
        }
        .snake-body {
            background-color: #059669; /* Emerald-600 */
            border-radius: 2px;
        }

        /* ì‚¬ê³¼ (ë¨¹ì´) ìŠ¤íƒ€ì¼ */
        .food {
            background-color: #ef4444; /* Red-500 */
            border-radius: 50%;
            animation: pulse 1s infinite alternate;
        }

        /* ê¹œë¹¡ì„ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes pulse {
            from { transform: scale(0.9); }
            to { transform: scale(1.1); }
        }
        
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body onkeydown="handleKeyDown(event)">

    <div class="bg-white p-6 rounded-xl shadow-2xl flex flex-col md:flex-row gap-6">
        
        <div class="w-full md:w-56 p-4 bg-gray-100 rounded-lg flex flex-col justify-between">
            <h1 class="text-3xl font-bold text-center mb-4 text-gray-800">ğŸ ë±€ ê²Œì„</h1>

            <div class="text-xl font-semibold mb-4 space-y-2">
                <div id="score-display" class="text-green-600"><i class="fas fa-apple-alt mr-2"></i> ì ìˆ˜: 0</div>
                <div id="status" class="text-red-600 font-bold">ëŒ€ê¸° ì¤‘...</div>
            </div>

            <div class="mb-4 text-sm text-gray-700">
                <h3 class="font-bold mb-1">ğŸ® ì¡°ì‘ í‚¤</h3>
                <ul class="list-disc list-inside space-y-0.5">
                    <li>**ì´ë™**: â†, â†‘, â†’, â†“ (ë°©í–¥í‚¤)</li>
                    <li>**ë©ˆì¶¤/ì¬ê°œ**: Space (ìŠ¤í˜ì´ìŠ¤ ë°”)</li>
                </ul>
            </div>

            <button id="start-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-lg transition-transform transform hover:scale-[1.02] active:scale-95">
                ê²Œì„ ì‹œì‘
            </button>
        </div>

        <div id="board-container" class="flex items-center justify-center">
            <div id="game-board">
                </div>
        </div>
    </div>

    <a href="/" class="block mt-4 text-center text-indigo-500 hover:text-indigo-700 font-medium">
        â† ë©”ì¸ ê²€ìƒ‰ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
    </a>

    <script>
        // --- ê²Œì„ ì„¤ì • ---
        const GRID_SIZE = 20; // 20x20 ê²©ì
        const INITIAL_SPEED = 150; // ì´ˆê¸° ì†ë„ (ms ë‹¹ ì´ë™)

        // --- DOM ìš”ì†Œ ---
        const boardElement = document.getElementById('game-board');
        const scoreDisplay = document.getElementById('score-display');
        const statusElement = document.getElementById('status');
        const startButton = document.getElementById('start-button');

        // --- ê²Œì„ ìƒíƒœ ë³€ìˆ˜ ---
        let snake;
        let food;
        let dx = 1; // x ë°©í–¥ ì´ë™ëŸ‰ (1: ì˜¤ë¥¸ìª½, -1: ì™¼ìª½)
        let dy = 0; // y ë°©í–¥ ì´ë™ëŸ‰ (1: ì•„ë˜, -1: ìœ„)
        let score = 0;
        let gameLoop;
        let isGameActive = false;
        let changingDirection = false; // ë°©í–¥ ì „í™˜ ì¤‘ ì¤‘ë³µ ì…ë ¥ ë°©ì§€
        let currentSpeed = INITIAL_SPEED;

        // --- ì´ˆê¸°í™” ë° ë Œë”ë§ ---

        function initializeGame() {
            snake = [{x: 10, y: 10}, {x: 9, y: 10}]; // ì´ˆê¸° ë±€ (ë¨¸ë¦¬, ëª¸í†µ)
            dx = 1; 
            dy = 0;
            score = 0;
            currentSpeed = INITIAL_SPEED;
            isGameActive = false;
            changingDirection = false;
            
            clearInterval(gameLoop);
            
            scoreDisplay.innerHTML = `<i class="fas fa-apple-alt mr-2"></i> ì ìˆ˜: 0`;
            statusElement.textContent = `ì¤€ë¹„, ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.`;
            startButton.textContent = `ê²Œì„ ì‹œì‘`;
            startButton.disabled = false;

            renderBoard();
            placeFood();
            draw();
        }

        function renderBoard() {
            boardElement.style.gridTemplateColumns = `repeat(${GRID_SIZE}, 1fr)`;
            boardElement.style.width = `${GRID_SIZE * 20 + 8}px`; // ì…€ í¬ê¸° 20px ê¸°ì¤€
            boardElement.style.height = `${GRID_SIZE * 20 + 8}px`; 
            boardElement.innerHTML = '';

            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.dataset.row = r;
                    cell.dataset.col = c;
                    boardElement.appendChild(cell);
                }
            }
        }

        // --- í•µì‹¬ ë¡œì§ ---

        // ë±€ê³¼ ë¨¹ì´ë¥¼ í™”ë©´ì— ê·¸ë¦¬ëŠ” í•¨ìˆ˜
        function draw() {
            // 1. ëª¨ë“  ì…€ í´ë˜ìŠ¤ ì´ˆê¸°í™”
            const allCells = boardElement.querySelectorAll('.cell');
            allCells.forEach(cell => {
                cell.className = 'cell';
            });

            // 2. ë±€ ê·¸ë¦¬ê¸°
            snake.forEach((segment, index) => {
                const cell = boardElement.querySelector(`[data-row="${segment.y}"][data-col="${segment.x}"]`);
                if (cell) {
                    if (index === 0) {
                        cell.classList.add('snake-head');
                    } else {
                        cell.classList.add('snake-body');
                    }
                }
            });

            // 3. ë¨¹ì´ ê·¸ë¦¬ê¸°
            const foodCell = boardElement.querySelector(`[data-row="${food.y}"][data-col="${food.x}"]`);
            if (foodCell) {
                foodCell.classList.add('food');
            }
        }

        // ë±€ ì´ë™ ë¡œì§
        function advanceSnake() {
            // ìƒˆ ë¨¸ë¦¬ ìœ„ì¹˜ ê³„ì‚°
            const newHead = {x: snake[0].x + dx, y: snake[0].y + dy};

            // ì¶©ëŒ í™•ì¸ (ë²½ ë˜ëŠ” ìê¸° ëª¸í†µ)
            if (checkCollision(newHead)) {
                gameOver();
                return;
            }

            // ë±€ ë¨¸ë¦¬ë¥¼ ì¶”ê°€í•˜ê³ 
            snake.unshift(newHead);

            // ë¨¹ì´ ì„­ì·¨ í™•ì¸
            if (newHead.x === food.x && newHead.y === food.y) {
                // ë¨¹ì´ë¥¼ ë¨¹ì—ˆìœ¼ë©´ ê¼¬ë¦¬ë¥¼ ìë¥´ì§€ ì•Šê³ , ì ìˆ˜ ì¦ê°€, ìƒˆ ë¨¹ì´ ë°°ì¹˜, ì†ë„ ì¦ê°€
                score += 10;
                scoreDisplay.innerHTML = `<i class="fas fa-apple-alt mr-2"></i> ì ìˆ˜: ${score}`;
                placeFood();
                
                // ì†ë„ ì¦ê°€ (ìµœì†Œ ì†ë„ 50ms)
                if (currentSpeed > 50) {
                    currentSpeed -= 5;
                    clearInterval(gameLoop);
                    gameLoop = setInterval(gameTick, currentSpeed);
                }

            } else {
                // ë¨¹ì§€ ì•Šì•˜ìœ¼ë©´ ê¼¬ë¦¬ë¥¼ ìë¦„ (ì´ë™ íš¨ê³¼)
                snake.pop();
            }

            changingDirection = false; // ë°©í–¥ ì „í™˜ ì ê¸ˆ í•´ì œ
            draw();
        }

        // ì¶©ëŒ í™•ì¸
        function checkCollision(head) {
            // 1. ìê¸° ëª¸í†µê³¼ ì¶©ëŒ
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) return true;
            }

            // 2. ë²½ê³¼ ì¶©ëŒ
            const hitLeftWall = head.x < 0;
            const hitRightWall = head.x >= GRID_SIZE;
            const hitTopWall = head.y < 0;
            const hitBottomWall = head.y >= GRID_SIZE;

            return hitLeftWall || hitRightWall || hitTopWall || hitBottomWall;
        }

        // ë¨¹ì´ ë°°ì¹˜
        function placeFood() {
            let newFood;
            do {
                newFood = {
                    x: Math.floor(Math.random() * GRID_SIZE),
                    y: Math.floor(Math.random() * GRID_SIZE)
                };
            } while (isSnakeSegment(newFood)); // ë±€ ëª¸í†µ ìœ„ì¹˜ì— ë¨¹ì´ ë°°ì¹˜ ë°©ì§€

            food = newFood;
        }

        // íŠ¹ì • ì¢Œí‘œê°€ ë±€ì˜ ëª¸í†µì¸ì§€ í™•ì¸
        function isSnakeSegment(pos) {
            return snake.some(segment => segment.x === pos.x && segment.y === pos.y);
        }

        // --- ê²Œì„ ê´€ë¦¬ ---

        function startGame() {
            if (isGameActive) {
                initializeGame();
            }
            
            isGameActive = true;
            statusElement.textContent = "ê²Œì„ ì§„í–‰ ì¤‘...";
            startButton.textContent = "ì¼ì‹œ ì •ì§€ (Space)";
            
            gameLoop = setInterval(gameTick, currentSpeed);
        }

        function gameTick() {
            if (isGameActive) {
                advanceSnake();
            }
        }

        function gameOver() {
            isGameActive = false;
            clearInterval(gameLoop);
            statusElement.textContent = "ê²Œì„ ì˜¤ë²„! ğŸ’€";
            startButton.textContent = "ë‹¤ì‹œ ì‹œì‘";
            startButton.disabled = false;
        }
        
        // --- í‚¤ë³´ë“œ ì…ë ¥ ì²˜ë¦¬ ---
        function handleKeyDown(e) {
            if (e.key === ' ') {
                e.preventDefault();
                togglePause();
                return;
            }

            if (!isGameActive || changingDirection) return;

            const keyPressed = e.key;

            const GOING_UP = dy === -1;
            const GOING_DOWN = dy === 1;
            const GOING_LEFT = dx === -1;
            const GOING_RIGHT = dx === 1;

            let newDx = dx;
            let newDy = dy;

            switch (keyPressed) {
                case 'ArrowLeft':
                    if (!GOING_RIGHT) { newDx = -1; newDy = 0; }
                    break;
                case 'ArrowUp':
                    if (!GOING_DOWN) { newDx = 0; newDy = -1; }
                    break;
                case 'ArrowRight':
                    if (!GOING_LEFT) { newDx = 1; newDy = 0; }
                    break;
                case 'ArrowDown':
                    if (!GOING_UP) { newDx = 0; newDy = 1; }
                    break;
                default:
                    return; // ë‹¤ë¥¸ í‚¤ ë¬´ì‹œ
            }
            
            // ë°©í–¥ì´ ì‹¤ì œë¡œ ë°”ë€ŒëŠ” ê²½ìš°ì—ë§Œ ì ìš©
            if (newDx !== dx || newDy !== dy) {
                changingDirection = true;
                dx = newDx;
                dy = newDy;
                e.preventDefault(); // ìŠ¤í¬ë¡¤ ë°©ì§€
            }
        }
        
        function togglePause() {
            if (isGameActive) {
                isGameActive = false;
                clearInterval(gameLoop);
                statusElement.textContent = "ì¼ì‹œ ì •ì§€ â¸ï¸";
                startButton.textContent = "ì¬ê°œ";
            } else if (!isGameOver) {
                isGameActive = true;
                statusElement.textContent = "ê²Œì„ ì§„í–‰ ì¤‘...";
                startButton.textContent = "ì¼ì‹œ ì •ì§€ (Space)";
                gameLoop = setInterval(gameTick, currentSpeed);
            }
        }

        // --- ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ì—°ê²° ---
        startButton.addEventListener('click', () => {
            if (startButton.textContent === 'ê²Œì„ ì‹œì‘' || startButton.textContent === 'ë‹¤ì‹œ ì‹œì‘') {
                startGame();
            } else {
                togglePause();
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        initializeGame();
    </script>
</body>
</html>