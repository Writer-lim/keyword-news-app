<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2048 ê²Œì„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f0f4f8; }
        #game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 10px;
            width: 440px;
            height: 440px;
            background-color: #bbada0;
            border-radius: 6px;
            padding: 10px;
        }
        .tile-container {
            position: relative;
            background-color: rgba(238, 228, 218, 0.35);
            border-radius: 3px;
        }
        .tile {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100px;
            height: 100px;
            border-radius: 3px;
            font-size: 32px;
            font-weight: 700;
            color: #776e65;
            transition: 100ms ease-in-out;
            transition-property: transform;
            transform: scale(1);
            /* ì´ˆê¸° ìœ„ì¹˜ëŠ” JSì—ì„œ ì„¤ì • */
        }
        .tile-2 { background-color: #eee4da; color: #776e65; }
        .tile-4 { background-color: #ede0c8; color: #776e65; }
        .tile-8 { background-color: #f2b179; color: #f9f6f2; font-size: 36px; }
        .tile-16 { background-color: #f59563; color: #f9f6f2; font-size: 36px; }
        .tile-32 { background-color: #f67c5f; color: #f9f6f2; font-size: 36px; }
        .tile-64 { background-color: #f65e3b; color: #f9f6f2; font-size: 36px; }
        .tile-128 { background-color: #edcf72; color: #f9f6f2; font-size: 30px; }
        .tile-256 { background-color: #edcc61; color: #f9f6f2; font-size: 30px; }
        .tile-512 { background-color: #edc850; color: #f9f6f2; font-size: 30px; }
        .tile-1024 { background-color: #edc53f; color: #f9f6f2; font-size: 24px; }
        .tile-2048 { background-color: #edc22e; color: #f9f6f2; font-size: 24px; }
        .tile-higher { background-color: #3c3a32; color: #f9f6f2; font-size: 24px; }

        .tile-new { animation: appear 200ms ease-in; }
        @keyframes appear { 0% { opacity: 0; transform: scale(0); } 100% { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4" onkeydown="handleKeyDown(event)">

    <div class="bg-white p-6 rounded-xl shadow-2xl flex flex-col items-center gap-6">
        
        <div class="flex justify-between items-center w-full max-w-[440px] mb-4">
            <h1 class="text-4xl font-bold text-gray-800">ğŸ”¥ 2048</h1>
            <div class="flex space-x-3">
                <div class="text-center p-2 bg-gray-200 rounded-lg">
                    <div class="text-xs font-medium text-gray-600">ì ìˆ˜</div>
                    <div id="score" class="text-xl font-extrabold text-gray-800">0</div>
                </div>
                <button id="restart-button" onclick="startGame()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 active:scale-95">
                    ìƒˆ ê²Œì„
                </button>
            </div>
        </div>

        <div id="game-message" class="text-center text-2xl font-bold text-red-600 hidden">
            ê²Œì„ ì˜¤ë²„!
        </div>

        <div id="game-board">
            </div>
        
        <div class="mt-4 text-sm text-gray-700 max-w-[440px] text-center">
            <h3 class="font-bold mb-1">ğŸ® ì¡°ì‘ í‚¤</h3>
            <p>í™”ì‚´í‘œ í‚¤ (â†‘, â†“, â†, â†’)ë¥¼ ì‚¬ìš©í•˜ì—¬ íƒ€ì¼ì„ ì´ë™ ë° í•©ì¹˜ì„¸ìš”.</p>
        </div>
    </div>

    <a href="/" class="block mt-4 text-center text-indigo-500 hover:text-indigo-700 font-medium">
        â† ë©”ì¸ ê²€ìƒ‰ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
    </a>

    <script>
        const GRID_SIZE = 4;
        const boardElement = document.getElementById('game-board');
        const scoreElement = document.getElementById('score');
        const messageElement = document.getElementById('game-message');
        
        let board;
        let score = 0;
        let tileId = 0;
        
        // íƒ€ì¼ ìƒ‰ìƒ ë° ìŠ¤íƒ€ì¼ ë§¤í•‘
        const tileClasses = {
            2: 'tile-2', 4: 'tile-4', 8: 'tile-8', 16: 'tile-16', 32: 'tile-32', 
            64: 'tile-64', 128: 'tile-128', 256: 'tile-256', 512: 'tile-512', 
            1024: 'tile-1024', 2048: 'tile-2048'
        };

        // --- ë³´ë“œ ë° íƒ€ì¼ ê´€ë¦¬ ---

        function setupBoard() {
            board = Array(GRID_SIZE).fill(0).map(() => Array(GRID_SIZE).fill(0));
            boardElement.innerHTML = '';
            
            // íƒ€ì¼ ì»¨í…Œì´ë„ˆ ìƒì„± (4x4 ê²©ì)
            for (let i = 0; i < GRID_SIZE * GRID_SIZE; i++) {
                const container = document.createElement('div');
                container.classList.add('tile-container');
                boardElement.appendChild(container);
            }
        }

        // ìƒˆ íƒ€ì¼ (2 ë˜ëŠ” 4)ì„ ë¹ˆ ìœ„ì¹˜ì— ì¶”ê°€
        function addRandomTile() {
            const availableCells = [];
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    if (board[r][c] === 0) {
                        availableCells.push({ r, c });
                    }
                }
            }
            if (availableCells.length > 0) {
                const { r, c } = availableCells[Math.floor(Math.random() * availableCells.length)];
                const value = Math.random() < 0.9 ? 2 : 4; // 90% í™•ë¥ ë¡œ 2, 10% í™•ë¥ ë¡œ 4
                board[r][c] = value;
                createTile(r, c, value, true);
            }
        }
        
        // íƒ€ì¼ DOM ìš”ì†Œë¥¼ ìƒì„±í•˜ê³  ë³´ë“œì— ë°°ì¹˜
        function createTile(r, c, value, isNew = false) {
            const tile = document.createElement('div');
            tile.id = `tile-${tileId++}`;
            tile.textContent = value;
            tile.classList.add('tile', tileClasses[value] || 'tile-higher');
            
            if (isNew) {
                tile.classList.add('tile-new');
            }
            
            // íƒ€ì¼ì˜ ìœ„ì¹˜ë¥¼ CSS transformìœ¼ë¡œ ì„¤ì •
            tile.style.left = `${c * 110 + 10}px`; // (100px width + 10px gap) * c + 10px padding
            tile.style.top = `${r * 110 + 10}px`;   // (100px height + 10px gap) * r + 10px padding
            tile.style.transform = 'translate(0, 0)';
            
            boardElement.appendChild(tile);
            return tile;
        }

        // ì „ì²´ ë³´ë“œë¥¼ ë Œë”ë§
        function renderBoard() {
            // ê¸°ì¡´ íƒ€ì¼ ì œê±° (ìƒˆë¡œìš´ ìœ„ì¹˜ì—ì„œ ë‹¤ì‹œ ê·¸ë¦¼)
            const tilesToRemove = Array.from(document.querySelectorAll('.tile'));
            tilesToRemove.forEach(tile => tile.remove());
            
            // ìƒˆ ìœ„ì¹˜ì— íƒ€ì¼ ë‹¤ì‹œ ìƒì„±
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    if (board[r][c] !== 0) {
                        createTile(r, c, board[r][c]);
                    }
                }
            }
            scoreElement.textContent = score;
        }

        // --- ê²Œì„ ë¡œì§: ì´ë™ ë° í•©ì¹˜ê¸° ---

        // ë°°ì—´ì„ ì£¼ì–´ì§„ ë°©í–¥ìœ¼ë¡œ ë°€ì–´ë‚´ê³  í•©ì¹˜ëŠ” ì½”ì–´ í•¨ìˆ˜
        function operateRow(row) {
            let moved = false;
            
            // 1. 0 ì œê±° (ì••ì¶•)
            let newRow = row.filter(val => val !== 0);
            let zeros = Array(GRID_SIZE - newRow.length).fill(0);
            newRow = newRow.concat(zeros);
            
            if (JSON.stringify(row) !== JSON.stringify(newRow)) {
                moved = true;
            }

            // 2. í•©ì¹˜ê¸°
            for (let i = 0; i < GRID_SIZE - 1; i++) {
                if (newRow[i] !== 0 && newRow[i] === newRow[i + 1]) {
                    newRow[i] *= 2;
                    score += newRow[i];
                    newRow[i + 1] = 0;
                    moved = true;
                }
            }

            // 3. ë‹¤ì‹œ ì••ì¶•
            newRow = newRow.filter(val => val !== 0);
            zeros = Array(GRID_SIZE - newRow.length).fill(0);
            newRow = newRow.concat(zeros);

            return { newRow, moved };
        }

        // ë³´ë“œë¥¼ ì‹œê³„ ë°©í–¥ìœ¼ë¡œ 90ë„ íšŒì „
        function rotateBoard(board) {
            const newBoard = createEmptyBoard();
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    newBoard[c][GRID_SIZE - 1 - r] = board[r][c];
                }
            }
            return newBoard;
        }

        // ì´ë™ ì²˜ë¦¬ í•¨ìˆ˜
        function move(direction) {
            let boardChanged = false;
            let originalBoard = JSON.parse(JSON.stringify(board)); // ì›ë³¸ ë³´ë“œ ì €ì¥
            
            let tempBoard = JSON.parse(JSON.stringify(board));

            // Up, Down, Left, Right ì´ë™ì„ ìœ„í•´ ë³´ë“œë¥¼ íšŒì „ (ì™¼ìª½ ì´ë™ ê¸°ì¤€ìœ¼ë¡œ í†µì¼)
            let numRotations = 0;
            if (direction === 'ArrowUp') numRotations = 3;
            if (direction === 'ArrowDown') numRotations = 1;
            if (direction === 'ArrowRight') numRotations = 2;
            
            for (let i = 0; i < numRotations; i++) {
                tempBoard = rotateBoard(tempBoard);
            }

            // ì™¼ìª½ìœ¼ë¡œ ì´ë™ ë° í•©ì¹˜ê¸°
            for (let r = 0; r < GRID_SIZE; r++) {
                const { newRow, moved } = operateRow(tempBoard[r]);
                if (moved) boardChanged = true;
                tempBoard[r] = newRow;
            }

            // ì›ë˜ ë°©í–¥ìœ¼ë¡œ ë‹¤ì‹œ íšŒì „
            let finalBoard = tempBoard;
            for (let i = 0; i < (4 - numRotations) % 4; i++) {
                finalBoard = rotateBoard(finalBoard);
            }

            if (boardChanged) {
                board = finalBoard;
                addRandomTile(); // ìƒˆ íƒ€ì¼ ì¶”ê°€
                renderBoard();
                
                if (isGameOver()) {
                    messageElement.textContent = "ê²Œì„ ì˜¤ë²„! ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.";
                    messageElement.classList.remove('hidden');
                }
            }
        }
        
        // ë¹ˆ ë³´ë“œ ìƒì„± (ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜)
        function createEmptyBoard() {
            return Array(GRID_SIZE).fill(0).map(() => Array(GRID_SIZE).fill(0));
        }

        // ê²Œì„ ì˜¤ë²„ ì¡°ê±´ í™•ì¸ (ë” ì´ìƒ ì›€ì§ì¼ ìˆ˜ ì—†ëŠ”ì§€)
        function isGameOver() {
            // ë¹ˆ ê³µê°„ì´ ìˆë‹¤ë©´ ê²Œì„ ì˜¤ë²„ ì•„ë‹˜
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    if (board[r][c] === 0) return false;
                }
            }

            // í•©ì¹  ìˆ˜ ìˆëŠ” íƒ€ì¼ì´ ìˆëŠ”ì§€ í™•ì¸
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    const current = board[r][c];
                    // ê°€ë¡œ ì²´í¬
                    if (c < GRID_SIZE - 1 && current === board[r][c + 1]) return false;
                    // ì„¸ë¡œ ì²´í¬
                    if (r < GRID_SIZE - 1 && current === board[r + 1][c]) return false;
                }
            }
            return true; // ë¹ˆ ê³µê°„ë„ ì—†ê³ , í•©ì¹  ê²ƒë„ ì—†ìŒ
        }

        // --- ê²Œì„ ì‹œì‘ ë° ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ---
        
        function startGame() {
            messageElement.classList.add('hidden');
            score = 0;
            tileId = 0;
            setupBoard();
            addRandomTile();
            addRandomTile();
            renderBoard();
        }

        function handleKeyDown(e) {
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault(); // ìŠ¤í¬ë¡¤ ë°©ì§€
                if (messageElement.classList.contains('hidden')) {
                    move(e.key);
                }
            }
        }

        // ì´ˆê¸° ì‹œì‘
        document.addEventListener('DOMContentLoaded', startGame);
    </script>
</body>
</html>