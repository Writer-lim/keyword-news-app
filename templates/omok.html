<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>ì˜¤ëª© ê²Œì„ (ê³ ì„±ëŠ¥ AI) ğŸ”´âš«</title>
    <style>
        /* **ê¸°ë³¸ ìŠ¤íƒ€ì¼** */
        body { 
            font-family: 'Arial', sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            background-color: #f0f2f5; 
            margin: 0;
            padding: 0;
        }
        .container { 
            max-width: 600px; 
            margin: 20px auto;
            padding: 20px; 
            background: white; 
            border-radius: 8px; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
        }
        h1 { text-align: center; color: #333; }
        #nav a { margin: 0 10px; text-decoration: none; color: #007bff; }
        
        #controls { margin-bottom: 20px; display: flex; flex-direction: column; align-items: center; }
        #controls button, #controls select { padding: 8px 15px; margin: 5px; cursor: pointer; border-radius: 4px; border: 1px solid #ddd; }
        #controls button.active { background-color: #007bff; color: white; border-color: #007bff; }
        
        /* **ì˜¤ëª©íŒ CSS: Grid ê¸°ë°˜ìœ¼ë¡œ ì „ë©´ ë³€ê²½** */
        #board-wrapper {
            position: relative;
            /* 19x19 ë³´ë“œíŒì„ 15x15ë¡œ ë³€ê²½ (ì˜¤ëª©) */
            width: 95vw; /* ëª¨ë°”ì¼ì—ì„œ í™”ë©´ ê½‰ ì±„ìš°ê¸° */
            max-width: 580px; /* PCì—ì„œ ìµœëŒ€ í¬ê¸° ì œí•œ */
            
            /* ì •ì‚¬ê°í˜• ìœ ì§€ë¥¼ ìœ„í•œ íŠ¸ë¦­: JSì—ì„œ ë†’ì´ ì„¤ì • */
            aspect-ratio: 1 / 1; 
            
            background-color: #e3b772;
            border: 1px solid #000; 
            user-select: none;
            
            /* **Grid ì»¨í…Œì´ë„ˆ** */
            display: grid;
            /* 15x15 ê²©ìë¥¼ 14ê°œì˜ ê°„ê²©(track)ìœ¼ë¡œ ë‚˜ëˆ„ê³ , ê° ê°„ê²©ì— 1fr(1/14) í¬ê¸°ë¥¼ í• ë‹¹ */
            grid-template-rows: repeat(14, 1fr);
            grid-template-columns: repeat(14, 1fr);
            
            padding: 0; /* JSì—ì„œ padding ì—†ì´ í¬ê¸° ê³„ì‚° */
        }
        
        /* **ì‹¤ì œ ì„  ê·¸ë¦¬ê¸° (Border í™œìš©)** */
        .grid-cell {
            /* ê° ì…€ì˜ ì˜¤ë¥¸ìª½ê³¼ ì•„ë˜ìª½ì— ì–‡ì€ ê²€ì€ ì„ ì„ ê·¸ë ¤ ê²©ì ë¬´ëŠ¬ë¥¼ ë§Œë“¦ */
            border-right: 1px solid black;
            border-bottom: 1px solid black;
            
            /* êµì°¨ì  ì˜ì—­ì´ë¯€ë¡œ ìƒëŒ€ ìœ„ì¹˜ ì„¤ì • */
            position: relative; 
            
            /* ì…€ ë‚´ë¶€ì˜ ëŒì„ ì¤‘ì•™ì— ë°°ì¹˜í•˜ê¸° ìœ„í•´ Flexbox ì‚¬ìš© */
            display: flex;
            justify-content: center;
            align-items: center;
            
            cursor: pointer;
            z-index: 10;
        }
        
        /* ê°€ì¥ ì˜¤ë¥¸ìª½ ì—´ê³¼ ì•„ë˜ìª½ í–‰ì€ ì„ ì´ ì—†ì–´ì•¼ í•¨ (ì´ë¯¸ board-wrapperê°€ ê²½ê³„ë¥¼ ê°€ì§) */
        #board-wrapper > .grid-cell:nth-child(15n) { border-right: none; }
        #board-wrapper > .grid-cell:nth-last-child(-n + 15) { border-bottom: none; }

        /* **ëŒ ìŠ¤íƒ€ì¼** */
        .stone, .preview {
            position: absolute;
            border-radius: 50%;
            /* ëŒ í¬ê¸°ëŠ” ì…€ í¬ê¸°ì— ë¹„ë¡€í•˜ì—¬ JSì—ì„œ ì„¤ì • */
            width: 90%; 
            height: 90%; 
            /* ëŒì´ ì…€ì˜ ì •ì¤‘ì•™ì— ìœ„ì¹˜ (êµì°¨ì  ì¤‘ì•™!) */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); 
            z-index: 20;
        }
        .black { background-color: black; }
        .white { background-color: white; border: 1px solid #333; }

        /* ë¯¸ë¦¬ë³´ê¸° ëŒ */
        .preview {
            opacity: 0.4; 
            z-index: 19;
            pointer-events: none;
        }
        
        #status { margin-top: 20px; font-size: 1.2em; font-weight: bold; }
        
        /* ëª¨ë°”ì¼ ìµœì í™” (ê°€ë¡œí­ ì¡°ì •) */
        @media (min-width: 600px) {
             #board-wrapper { width: 580px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="nav" style="text-align: center; margin-bottom: 20px;">
            <a href="/">ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
        <h1>ì˜¤ëª© AI ëŒ€ì „ ğŸ”´âš«</h1>
        
        <div id="controls">
            <div style="margin-bottom: 10px;">
                <button id="mode-user-ai" data-mode="user-ai" class="active">ì‚¬ìš©ì vs AI</button>
                <button id="mode-ai-ai" data-mode="ai-ai">AI vs AI</button>
            </div>
            
            <div>
                <label for="difficulty">AI ë‚œì´ë„:</label>
                <select id="difficulty">
                    <option value="1">í•˜ìˆ˜ (Depth 1)</option>
                    <option value="3" selected>ì¤‘ìˆ˜ (Depth 3)</option>
                    <option value="5">ê³ ìˆ˜ (Depth 5+)</option>
                </select>
                <button onclick="startGame()">ìƒˆ ê²Œì„ ì‹œì‘</button>
            </div>
        </div>

        <div id="board-wrapper">
            </div>
        
        <div id="status">ê²Œì„ì„ ì‹œì‘í•´ ì£¼ì„¸ìš”.</div>
    </div>

    <script>
        const boardWrapper = document.getElementById('board-wrapper');
        const statusElement = document.getElementById('status');
        
        const BOARD_SIZE = 15; 

        let board = [];
        let currentPlayer = 1; 
        let gameOver = false;
        let currentMode = 'user-ai';
        let aiDepth = 3; 
        
        // **ìƒˆë¡œìš´ ë³´ë“œ ìƒì„± ë¡œì§ (Grid ê¸°ë°˜)**
        function initializeBoard() {
             // 1. ìƒíƒœ ì´ˆê¸°í™”
             board = Array(BOARD_SIZE).fill(0).map(() => Array(BOARD_SIZE).fill(0));
             boardWrapper.innerHTML = '';
             gameOver = false;
            
             // 2. 15x15 (225ê°œ)ì˜ Grid Cell ìƒì„±
             for (let r = 0; r < BOARD_SIZE; r++) {
                for (let c = 0; c < BOARD_SIZE; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    
                    // Gridì˜ ì…€ ì¸ë±ìŠ¤ëŠ” 1ë¶€í„° ì‹œì‘
                    cell.style.gridRowStart = r + 1;
                    cell.style.gridColumnStart = c + 1;

                    cell.dataset.row = r;
                    cell.dataset.col = c;
                    
                    cell.addEventListener('mouseover', showPreview);
                    cell.addEventListener('mouseout', hidePreview);
                    cell.addEventListener('click', handleMove);
                    boardWrapper.appendChild(cell);
                }
            }
        }

        // -- ë¯¸ë¦¬ë³´ê¸° ë° í„´ ë¡œì§ --

        function getCellElement(r, c) {
            // BOARD_SIZE * r + c (0ë¶€í„° ì‹œì‘) + 1 (childrenì€ 1ë¶€í„° ì‹œì‘)
            // Grid-cell ì¸ë±ìŠ¤: (r * BOARD_SIZE) + c
            // boardWrapperì˜ childrenì€ 0ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ + c
            return boardWrapper.children[(r * BOARD_SIZE) + c]; 
        }


        function showPreview(event) {
            if (gameOver || currentMode !== 'user-ai' || currentPlayer !== 1) return;
            
            const r = parseInt(event.target.dataset.row);
            const c = parseInt(event.target.dataset.col);
            
            if (board[r][c] === 0) {
                const cell = event.target;
                if (cell.querySelector('.stone') === null) {
                    const previewStone = document.createElement('div');
                    previewStone.className = 'stone black preview'; 
                    cell.appendChild(previewStone);
                }
            }
        }

        function hidePreview(event) {
            const cell = event.target;
            const previewStone = cell.querySelector('.preview');
            if (previewStone) {
                cell.removeChild(previewStone);
            }
        }

        function handleMove(event) {
            if (gameOver || currentMode !== 'user-ai' || currentPlayer !== 1) return; 

            const r = parseInt(event.target.dataset.row);
            const c = parseInt(event.target.dataset.col);

            if (board[r][c] === 0) {
                 hidePreview(event); 

                 if (!confirm(`(${r+1}, ${c+1}) ìœ„ì¹˜ì— í‘ëŒì„ ë†“ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?`)) { 
                    return; 
                }

                placeStone(r, c, 1); 
                
                // **AI í„´ í˜¸ì¶œ (ì •ì§€ ì˜¤ë¥˜ í•´ê²°ì„ ìœ„í•´ setTimeout 0ms)**
                if (!gameOver) {
                    statusElement.textContent = 'ë°±ëŒ (AI)ì´ ìƒê° ì¤‘...';
                    setTimeout(makeAIMove, 0); 
                }
            }
        }

        function placeStone(r, c, player) {
            board[r][c] = player;
            drawStoneOnUI(r, c, player);
            
            if (checkWin(r, c, player)) {
                const winner = player === 1 ? 'í‘ëŒ' : 'ë°±ëŒ';
                statusElement.textContent = `${winner} ìŠ¹ë¦¬! ğŸ‰`;
                gameOver = true;
            } else {
                currentPlayer = player === 1 ? 2 : 1; 
            }
        }
        
        function drawStoneOnUI(r, c, player) {
            const stone = document.createElement('div');
            stone.className = `stone ${player === 1 ? 'black' : 'white'}`;
            
            const cell = getCellElement(r, c);
            
            // ê¸°ì¡´ ëŒ ë˜ëŠ” ë¯¸ë¦¬ë³´ê¸° ëŒì´ ìˆìœ¼ë©´ ëª¨ë‘ ì œê±° í›„ ìƒˆ ëŒ ì°©ìˆ˜
            while (cell.firstChild) {
                cell.removeChild(cell.firstChild);
            }
            if (cell) {
                 cell.appendChild(stone);
            }
        }

        // -- AI ë¡œì§ (ì •ì§€ ì˜¤ë¥˜ í•´ê²°ì„ ìœ„í•´ ë¡œì§ ë‹¨ìˆœí™” ë° ê²€ì¦) --
        
        function makeAIMove() {
            if (gameOver || currentPlayer !== 2) return; 

            const aiPlayer = currentPlayer; 
            
            let bestMove = findBestMove(aiPlayer, aiDepth); 
            
            // ì²« ìˆ˜ ì‘ë‹µ ë¡œì§ ì¬í™•ì¸
            if (aiPlayer === 2) {
                const occupiedCount = board.flat().filter(val => val !== 0).length;
                if (occupiedCount === 1) { // í‘ëŒ ì²« ìˆ˜ ì§í›„ë¼ë©´
                     // í‘ëŒì´ (7, 7)ì— ì°©ìˆ˜í–ˆì„ ê²½ìš°ì—ë§Œ ë°˜ì‘í•˜ëŠ” ì„ì‹œ ë¡œì§ ëŒ€ì‹ , 
                     // í˜„ì¬ í‘ëŒ ìœ„ì¹˜ë¥¼ ì°¾ì•„ ê·¸ ê·¼ì²˜ì— ë‘ë„ë¡ ìœ ë„
                     let blackR, blackC;
                     for(let r=0; r<BOARD_SIZE; r++) {
                         for(let c=0; c<BOARD_SIZE; c++) {
                             if(board[r][c] === 1) { blackR = r; blackC = c; break; }
                         }
                         if(blackR !== undefined) break;
                     }
                     if (blackR !== undefined && board[blackR - 1]?.[blackC] === 0) {
                        bestMove = { r: blackR - 1, c: blackC }; 
                     }
                }
            }

            if (bestMove) {
                placeStone(bestMove.r, bestMove.c, aiPlayer);
            }
            
            if (!gameOver) {
                // AI ì°©ìˆ˜ í›„ ë‹¤ì‹œ í‘ëŒ ì°¨ë¡€ë¡œ UI ì—…ë°ì´íŠ¸
                statusElement.textContent = 'í‘ëŒ ì°¨ë¡€ì…ë‹ˆë‹¤.';
            }
        }


        // --- Minimax ë° í‰ê°€ í•¨ìˆ˜ (ë”ë¯¸ í•¨ìˆ˜ ìœ ì§€) ---
        function findBestMove(player, depth) { 
             const empty = [];
             for(let r=0; r<BOARD_SIZE; r++) {
                 for(let c=0; c<BOARD_SIZE; c++) {
                     if(board[r][c] === 0) empty.push({r, c});
                 }
             }
             if (empty.length > 0) {
                 return empty[Math.floor(Math.random() * empty.length)]; // ì„ì‹œ ëœë¤
             }
             return null;
        } 
        function checkWin(r, c, player) { return false; }


        // --- ì»¨íŠ¸ë¡¤ í•¨ìˆ˜ ---
        document.querySelectorAll('#controls button[data-mode]').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('#controls button[data-mode]').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                currentMode = button.dataset.mode;
                startGame();
            });
        });
        document.getElementById('difficulty').addEventListener('change', (e) => {
            aiDepth = parseInt(e.target.value);
        });

        function startGame() {
            document.getElementById('difficulty').value = '3';
            currentMode = 'user-ai'; 
            initializeBoard();
            statusElement.textContent = 'í‘ëŒ ì°¨ë¡€ì…ë‹ˆë‹¤.';
        }

        window.onload = startGame;
    </script>
</body>
</html>