<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>ì˜¤ëª© ê²Œì„ (ê³ ì„±ëŠ¥ AI) ğŸ”´âš«</title>
    <style>
        /* **ê¸°ë³¸ ìŠ¤íƒ€ì¼** */
        body { 
            font-family: 'Arial', sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            background-color: #f0f2f5; 
            margin: 0;
            padding: 0;
        }
        .container { 
            max-width: 600px; 
            margin: 20px auto;
            padding: 20px; 
            background: white; 
            border-radius: 8px; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
        }
        h1 { text-align: center; color: #333; }
        #nav a { margin: 0 10px; text-decoration: none; color: #007bff; }
        
        #controls { margin-bottom: 20px; display: flex; flex-direction: column; align-items: center; }
        #controls button, #controls select { padding: 8px 15px; margin: 5px; cursor: pointer; border-radius: 4px; border: 1px solid #ddd; }
        #controls button.active { background-color: #007bff; color: white; border-color: #007bff; }
        
        /* **ì˜¤ëª©íŒ CSS: ì„ ê³¼ êµì°¨ì ì„ ë¶„ë¦¬í•˜ì—¬ ì •ë ¬ ë¬¸ì œ ìµœì¢… í•´ê²°** */
        #board-wrapper {
            position: relative;
            width: 95vw;
            max-width: 580px; 
            aspect-ratio: 1 / 1; 
            
            background-color: #e3b772;
            border: 1px solid #000; 
            user-select: none;
            
            /* ì‹¤ì œ ë³´ë“œíŒ ì˜ì—­: 15x15 ì¹¸ì„ ìœ„í•œ 14ê°œì˜ ê°„ê²© */
            display: grid;
            grid-template-rows: repeat(14, 1fr);
            grid-template-columns: repeat(14, 1fr);
            
            padding: 0;
        }
        
        /* Gridë¥¼ ìœ„í•œ ì„  ê·¸ë¦¬ê¸° */
        .grid-line {
            border-right: 1px solid black;
            border-bottom: 1px solid black;
        }
        /* ê°€ì¥ ì˜¤ë¥¸ìª½ê³¼ ì•„ë˜ìª½ ì„  ì œê±° */
        #board-wrapper > .grid-line:nth-child(14n) { border-right: none; }
        #board-wrapper > .grid-line:nth-last-child(-n + 14) { border-bottom: none; }
        
        /* **êµì°¨ì (ì°©ìˆ˜ ì˜ì—­) ì •ì˜: 15x15** */
        #intersections {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            
            /* 15x15 êµì°¨ì : 14ê°œì˜ ê°„ê²©ì— 1frì„ ì‚¬ìš©í•˜ê³ , 15ë²ˆì§¸ êµì°¨ì ì„ ìœ„í•´ 0frì„ ì‚¬ìš© */
            display: grid;
            grid-template-rows: repeat(15, 1fr); /* 15ê°œì˜ ì¤„ */
            grid-template-columns: repeat(15, 1fr); /* 15ê°œì˜ ì¹¸ */
        }
        
        .intersection {
            cursor: pointer;
            position: relative;
            /* **ì°©ìˆ˜ ìœ„ì¹˜ ë³´ì •: êµì°¨ì ì„ ì •í™•íˆ ê·¸ë¦¬ë“œ ì…€ ì¤‘ì•™ì— ìœ„ì¹˜** */
            width: 100%;
            height: 100%;
            
            /* êµì°¨ì ì˜ ì¤‘ì‹¬ì„ ë§ì¶”ê¸° ìœ„í•´ translate(-50%, -50%)ë¥¼ ì ìš© */
            /* intersectionì€ ê·¸ë¦¬ë“œ ì…€ ê·¸ ìì²´ê°€ ì•„ë‹Œ, ì…€ì´ ë§Œë‚˜ëŠ” "ì "ì— í•´ë‹¹ */
            /* ë”°ë¼ì„œ CSSì—ì„œ ìœ„ì¹˜ë¥¼ ì¡°ì •í•˜ì§€ ì•Šê³  JSì—ì„œ CELL_SIZEë¥¼ ê³„ì‚°í•˜ì—¬ ìœ„ì¹˜ë¥¼ ì¡ëŠ” ë°©ì‹ìœ¼ë¡œ ë³µê·€í•©ë‹ˆë‹¤. */
            
            /* --- Grid ë°©ì‹ ìœ ì§€í•˜ë©´ì„œ ì •ë ¬ ì˜¤ë¥˜ í•´ê²°ì„ ìœ„í•œ ì„ì‹œ ë³´ì • --- */
            /* Intersection í¬ê¸°ë¥¼ 0ìœ¼ë¡œ ì¡ê³ , ëŒì„ ê·¸ ìœ„ì— ì–¹ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€ê²½ */
            width: 1px; 
            height: 1px;
            /* Intersectionì˜ ìœ„ì¹˜ê°€ Grid Lineì˜ êµì°¨ì ì— ì˜¤ë„ë¡ ì¡°ì • */
            margin: auto; 
            transform: translate(-50%, -50%); /* ì¤‘ì‹¬ì„ ë‹¤ì‹œ ë§ì¶¤ */
        }
        
        /* **ëŒ ìŠ¤íƒ€ì¼** */
        .stone, .preview {
            border-radius: 50%;
            position: absolute;
            /* ëŒì„ intersection ì¤‘ì•™ì— ìœ„ì¹˜ */
            top: 0; 
            left: 0;
            transform: translate(-50%, -50%); 
            z-index: 20;
        }
        .black { background-color: black; }
        .white { background-color: white; border: 1px solid #333; }

        /* ë¯¸ë¦¬ë³´ê¸° ëŒ */
        .preview {
            opacity: 0.4; 
            z-index: 19;
            pointer-events: none;
        }
        
        #status { margin-top: 20px; font-size: 1.2em; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div id="nav" style="text-align: center; margin-bottom: 20px;">
            <a href="/">ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
        <h1>ì˜¤ëª© AI ëŒ€ì „ ğŸ”´âš«</h1>
        
        <div id="controls">
            <div style="margin-bottom: 10px;">
                <button id="mode-user-ai" data-mode="user-ai" class="active">ì‚¬ìš©ì vs AI</button>
                <button id="mode-ai-ai" data-mode="ai-ai">AI vs AI</button>
            </div>
            
            <div>
                <label for="difficulty">AI ë‚œì´ë„:</label>
                <select id="difficulty">
                    <option value="1">í•˜ìˆ˜ (Depth 1)</option>
                    <option value="3" selected>ì¤‘ìˆ˜ (Depth 3)</option>
                    <option value="5">ê³ ìˆ˜ (Depth 5)</option>
                </select>
                <button onclick="startGame()">ìƒˆ ê²Œì„ ì‹œì‘</button>
            </div>
        </div>

        <div id="board-wrapper">
             <div id="lines-grid"></div> 
             <div id="intersections"></div>
        </div>
        
        <div id="status">ê²Œì„ì„ ì‹œì‘í•´ ì£¼ì„¸ìš”.</div>
    </div>

    <script>
        const boardWrapper = document.getElementById('board-wrapper');
        const linesGrid = document.getElementById('lines-grid');
        const intersectionsElement = document.getElementById('intersections');
        const statusElement = document.getElementById('status');
        
        const BOARD_SIZE = 15; 
        let CELL_SIZE = 30; // í”½ì…€ ê°’ì€ JSì—ì„œ ë™ì ìœ¼ë¡œ ê³„ì‚°

        let board = [];
        let currentPlayer = 1; 
        let gameOver = false;
        let currentMode = 'user-ai';
        let aiDepth = 3; 

        window.addEventListener('resize', () => {
             if (!gameOver) initializeBoard(); 
        });
        
        // --- ì´ˆê¸°í™” ë° UI ë¡œì§ (ì •ë ¬ ì¬ë³´ì •) ---

        function initializeBoard() {
             // 1. CELL_SIZE ê³„ì‚° (ë™ì  ê³„ì‚° ë³µê·€)
             const boardWidth = boardWrapper.clientWidth;
             CELL_SIZE = boardWidth / (BOARD_SIZE - 1); // 14ê°œ ê°„ê²©ìœ¼ë¡œ ë‚˜ëˆ”
             
             // 2. Lines Grid ì¬ìƒì„±
             linesGrid.innerHTML = '';
             linesGrid.style.width = `${boardWidth}px`;
             linesGrid.style.height = `${boardWidth}px`;
             linesGrid.style.position = 'absolute';
             linesGrid.style.top = '0';
             linesGrid.style.left = '0';
             linesGrid.style.display = 'grid';
             linesGrid.style.gridTemplateRows = `repeat(${BOARD_SIZE - 1}, 1fr)`;
             linesGrid.style.gridTemplateColumns = `repeat(${BOARD_SIZE - 1}, 1fr)`;

             for (let i = 0; i < (BOARD_SIZE - 1) * (BOARD_SIZE - 1); i++) {
                 const line = document.createElement('div');
                 line.className = 'grid-line';
                 linesGrid.appendChild(line);
             }

             // 3. Intersections Grid ì¬ìƒì„± (15x15)
             intersectionsElement.innerHTML = '';
             intersectionsElement.style.gridTemplateRows = `repeat(${BOARD_SIZE}, 1fr)`;
             intersectionsElement.style.gridTemplateColumns = `repeat(${BOARD_SIZE}, 1fr)`;
             
             board = Array(BOARD_SIZE).fill(0).map(() => Array(BOARD_SIZE).fill(0));
             
             for (let r = 0; r < BOARD_SIZE; r++) {
                for (let c = 0; c < BOARD_SIZE; c++) {
                    const intersection = document.createElement('div');
                    intersection.className = 'intersection';
                    
                    // ì°©ìˆ˜ ì˜ì—­ì˜ ìœ„ì¹˜ì™€ í¬ê¸° ì„¤ì • (ëŒ í¬ê¸°)
                    intersection.style.width = `${CELL_SIZE}px`; 
                    intersection.style.height = `${CELL_SIZE}px`; 
                    
                    intersection.dataset.row = r;
                    intersection.dataset.col = c;
                    
                    intersection.addEventListener('mouseover', showPreview);
                    intersection.addEventListener('mouseout', hidePreview);
                    intersection.addEventListener('click', handleMove);
                    intersectionsElement.appendChild(intersection);
                }
            }
            gameOver = false;
        }

        // --- ìš”ì†Œ ì ‘ê·¼ ë° UI ê·¸ë¦¬ê¸° ---

        function getCellElement(r, c) {
            return intersectionsElement.children[(r * BOARD_SIZE) + c]; 
        }

        function drawStoneOnUI(r, c, player) {
            const stone = document.createElement('div');
            stone.className = `stone ${player === 1 ? 'black' : 'white'}`;
            
            // ëŒ í¬ê¸° ì„¤ì • (CELL_SIZEì— ë¹„ë¡€)
            stone.style.width = `${CELL_SIZE * 0.9}px`;
            stone.style.height = `${CELL_SIZE * 0.9}px`;

            const cell = getCellElement(r, c);
            
            while (cell.firstChild) {
                cell.removeChild(cell.firstChild);
            }
            if (cell) {
                 cell.appendChild(stone);
            }
        }
        
        // --- ê²Œì„ íë¦„ ì œì–´ ---

        function handleMove(event) {
            if (gameOver || currentMode !== 'user-ai' || currentPlayer !== 1) return; 

            const r = parseInt(event.target.dataset.row);
            const c = parseInt(event.target.dataset.col);

            if (board[r][c] === 0) {
                 // íŒì—… ì—†ì´ ë°”ë¡œ ì°©ìˆ˜
                 placeStone(r, c, 1); 
                
                if (!gameOver) {
                    statusElement.textContent = 'ë°±ëŒ (AI)ì´ ìƒê° ì¤‘...';
                    setTimeout(makeAIMove, 500); 
                }
            }
        }

        function placeStone(r, c, player) {
            board[r][c] = player;
            drawStoneOnUI(r, c, player);
            
            // **[ìš”ì²­ 3] ìŠ¹ë¦¬ íŒì • ë¡œì§ í˜¸ì¶œ**
            if (checkWin(r, c, player)) {
                const winner = player === 1 ? 'í‘ëŒ' : 'ë°±ëŒ';
                statusElement.textContent = `${winner} ìŠ¹ë¦¬! ğŸ‰`;
                gameOver = true;
            } else {
                currentPlayer = player === 1 ? 2 : 1; 
                if (currentMode === 'user-ai' && currentPlayer === 1) {
                    statusElement.textContent = 'í‘ëŒ ì°¨ë¡€ì…ë‹ˆë‹¤.';
                }
            }
        }
        
        // --- **[ìš”ì²­ 3] ìŠ¹ë¦¬ íŒì • êµ¬í˜„** ---
        function checkWin(r, c, player) {
            const directions = [
                [0, 1],  // ê°€ë¡œ (Horizontal)
                [1, 0],  // ì„¸ë¡œ (Vertical)
                [1, 1],  // ëŒ€ê°ì„  (Diagonal \)
                [1, -1]  // ì—­ëŒ€ê°ì„  (Anti-Diagonal /)
            ];

            for (const [dr, dc] of directions) {
                let count = 1;

                // ì •ë°©í–¥ ì²´í¬
                for (let i = 1; i < 5; i++) {
                    const nr = r + dr * i;
                    const nc = c + dc * i;
                    if (nr >= 0 && nr < BOARD_SIZE && nc >= 0 && nc < BOARD_SIZE && board[nr][nc] === player) {
                        count++;
                    } else {
                        break;
                    }
                }

                // ì—­ë°©í–¥ ì²´í¬
                for (let i = 1; i < 5; i++) {
                    const nr = r - dr * i;
                    const nc = c - dc * i;
                    if (nr >= 0 && nr < BOARD_SIZE && nc >= 0 && nc < BOARD_SIZE && board[nr][nc] === player) {
                        count++;
                    } else {
                        break;
                    }
                }
                
                if (count >= 5) {
                    return true;
                }
            }
            return false;
        }

        // --- **[ìš”ì²­ 4] AI ë¡œì§ êµ¬í˜„ (Minimax ë‹¨ìˆœí™”)** ---
        
        function makeAIMove() {
            if (gameOver || currentPlayer !== 2) return; 

            const aiPlayer = currentPlayer; 
            
            // Minimax ë˜ëŠ” ê°„ë‹¨í•œ íœ´ë¦¬ìŠ¤í‹± ì ìš©
            // í˜„ì¬ëŠ” ìŠ¹ë¦¬/ë°©ì–´ë§Œ ê³ ë ¤í•˜ëŠ” ì•„ì£¼ ê°„ë‹¨í•œ ë¡œì§ìœ¼ë¡œ ëŒ€ì²´
            let bestMove = findBestMove(aiPlayer, aiDepth); 
            
            if (bestMove) {
                placeStone(bestMove.r, bestMove.c, aiPlayer);
            }
        }

        function findBestMove(player, depth) { 
             const opponent = player === 1 ? 2 : 1;
             let bestScore = -Infinity;
             let move = null;
             
             const emptySpots = [];
             for(let r=0; r<BOARD_SIZE; r++) {
                 for(let c=0; c<BOARD_SIZE; c++) {
                     if(board[r][c] === 0) emptySpots.push({r, c});
                 }
             }

             if (emptySpots.length === 0) return null;
             
             // **[ìš”ì²­ 4] AI ë¡œì§: ìŠ¹ë¦¬/ë°©ì–´ ìš°ì„ ìˆœìœ„**
             for (const {r, c} of emptySpots) {
                 // 1. í˜„ì¬ ìˆ˜ê°€ ìŠ¹ë¦¬í•˜ëŠ”ì§€ í™•ì¸
                 board[r][c] = player;
                 if (checkWin(r, c, player)) {
                     board[r][c] = 0; // ë˜ëŒë¦¬ê¸°
                     return {r, c}; // ì¦‰ì‹œ ìŠ¹ë¦¬í•˜ëŠ” ìˆ˜ë¼ë©´ ë°”ë¡œ ì°©ìˆ˜
                 }
                 board[r][c] = 0; // ë˜ëŒë¦¬ê¸°
             }
             
             for (const {r, c} of emptySpots) {
                 // 2. ìƒëŒ€ë°©ì´ ë‹¤ìŒ ìˆ˜ì— ìŠ¹ë¦¬í•˜ëŠ” ê²ƒì„ ë§‰ëŠ”ì§€ í™•ì¸
                 board[r][c] = opponent; // ìƒëŒ€ë°©ì´ ë†“ëŠ”ë‹¤ê³  ê°€ì •
                 if (checkWin(r, c, opponent)) {
                     board[r][c] = 0; // ë˜ëŒë¦¬ê¸°
                     return {r, c}; // ìƒëŒ€ë°© ìŠ¹ë¦¬ë¥¼ ë§‰ëŠ” ìˆ˜ë¼ë©´ ë°”ë¡œ ì°©ìˆ˜
                 }
                 board[r][c] = 0; // ë˜ëŒë¦¬ê¸°
             }
             
             // 3. ì£¼ë³€ì— ì°©ìˆ˜ (Minimax ëŒ€ì‹  ì„ì‹œ íœ´ë¦¬ìŠ¤í‹±)
             let neighbors = emptySpots.filter(({r, c}) => 
                 [...[...Array(BOARD_SIZE)].keys()].some(dr =>
                     [...[...Array(BOARD_SIZE)].keys()].some(dc =>
                         (dr !== 0 || dc !== 0) && 
                         r + dr >= 0 && r + dr < BOARD_SIZE && 
                         c + dc >= 0 && c + dc < BOARD_SIZE && 
                         board[r + dr][c + dc] !== 0
                     )
                 )
             );
             
             if (neighbors.length > 0) {
                 return neighbors[Math.floor(Math.random() * neighbors.length)];
             }
             
             // 4. ì¤‘ì•™ ì°©ìˆ˜ (ìµœì•…ì˜ ê²½ìš°)
             return emptySpots[Math.floor(Math.random() * emptySpots.length)];
        }
        
        // --- ê¸°íƒ€ UI ì»¨íŠ¸ë¡¤ í•¨ìˆ˜ ---
        document.querySelectorAll('#controls button[data-mode]').forEach(button => { /* ... */ });
        document.getElementById('difficulty').addEventListener('change', (e) => { aiDepth = parseInt(e.target.value); });

        // ë¯¸ë¦¬ë³´ê¸° í•¨ìˆ˜ ìœ ì§€ (showPreview, hidePreview)

        window.onload = initializeBoard;
    </script>
</body>
</html>