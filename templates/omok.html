<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>ì˜¤ëª© ê²Œì„ (ê³ ì„±ëŠ¥ AI) ğŸ”´âš«</title>
    <style>
        body { font-family: 'Arial', sans-serif; display: flex; flex-direction: column; align-items: center; background-color: #f0f2f5; }
        .container { max-width: 600px; margin: 20px; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        h1 { text-align: center; color: #333; }
        #nav a { margin: 0 10px; text-decoration: none; color: #007bff; }
        
        #controls { margin-bottom: 20px; display: flex; flex-direction: column; align-items: center; }
        #controls button, #controls select { padding: 8px 15px; margin: 5px; cursor: pointer; border-radius: 4px; border: 1px solid #ddd; }
        #controls button.active { background-color: #007bff; color: white; border-color: #007bff; }
        
        /* ì˜¤ëª©íŒ ì „ì²´ ë˜í¼ */
        #board-wrapper {
            position: relative;
            /* width/heightëŠ” JSì—ì„œ ë™ì ìœ¼ë¡œ ì„¤ì • */
            padding: 15px; 
            background-color: #e3b772;
            border: 1px solid #000; 
            user-select: none;
        }
        
        /* ë¼ì¸ ë° êµì°¨ì  ì˜ì—­ (íŒ¨ë”© 15pxë§Œí¼ ì´ë™) */
        #lines, #intersections {
            position: absolute;
            top: 15px; 
            left: 15px;
            /* width/heightëŠ” JSì—ì„œ ë™ì ìœ¼ë¡œ ì„¤ì • */
        }

        /* ì„ : ë‘ê»˜ í†µì¼ */
        .line-h, .line-v {
            position: absolute;
            background-color: #000;
        }
        .line-h { height: 1px; left: 0; right: 0; transform: translateY(-0.5px); }
        .line-v { width: 1px; top: 0; bottom: 0; transform: translateX(-0.5px); }
        
        /* êµì°¨ì  ì˜ì—­ (í¬ê¸°ì™€ ìœ„ì¹˜ëŠ” JSì—ì„œ CELL_SIZE ê¸°ë°˜ìœ¼ë¡œ ì„¤ì •) */
        .intersection {
            position: absolute;
            cursor: pointer;
            z-index: 10;
        }
        
        .stone {
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); 
        }
        .black { background-color: black; z-index: 20; }
        .white { background-color: white; border: 1px solid #333; z-index: 20; }

        /* **[ìš”ì²­ 2] ë¯¸ë¦¬ë³´ê¸° ëŒ ìŠ¤íƒ€ì¼ ì¶”ê°€** */
        .preview {
            background-color: black; 
            opacity: 0.4; /* íˆ¬ëª…í•˜ê²Œ */
            z-index: 19;
            pointer-events: none; /* í´ë¦­ ì´ë²¤íŠ¸ ë°©ì§€ */
        }
        
        #status { margin-top: 20px; font-size: 1.2em; font-weight: bold; }
        
        /* ëª¨ë°”ì¼ ìµœì í™”: ë ˆì´ì•„ì›ƒ ê¹¨ì§ ìˆ˜ì • ë° ë™ì  í¬ê¸° ì ìš© */
        @media (max-width: 600px) {
             .container { padding: 10px; }
             #board-wrapper { 
                 /* í™”ë©´ ë„ˆë¹„ì˜ 95%ë¥¼ ì‚¬ìš©í•˜ê³ , ê·¸ í¬ê¸°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¶€ë¥¼ ì±„ì›€ */
                 width: calc(95vw - 30px);
                 height: calc(95vw - 30px);
                 max-width: 570px;
                 max-height: 570px;
                 padding: 15px; 
             }
        }

    </style>
</head>
<body>
    <div class="container">
        <div id="nav" style="text-align: center; margin-bottom: 20px;">
            <a href="/">ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
        <h1>ì˜¤ëª© AI ëŒ€ì „ ğŸ”´âš«</h1>
        
        <div id="controls">
            <div style="margin-bottom: 10px;">
                <button id="mode-user-ai" data-mode="user-ai" class="active">ì‚¬ìš©ì vs AI</button>
                <button id="mode-ai-ai" data-mode="ai-ai">AI vs AI</button>
            </div>
            
            <div>
                <label for="difficulty">AI ë‚œì´ë„:</label>
                <select id="difficulty">
                    <option value="1">í•˜ìˆ˜ (Depth 1)</option>
                    <option value="3" selected>ì¤‘ìˆ˜ (Depth 3)</option>
                    <option value="5">ê³ ìˆ˜ (Depth 5+)</option>
                </select>
                <button onclick="startGame()">ìƒˆ ê²Œì„ ì‹œì‘</button>
            </div>
        </div>

        <div id="board-wrapper">
            <div id="lines"></div>
            <div id="intersections"></div>
        </div>
        
        <div id="status">ê²Œì„ì„ ì‹œì‘í•´ ì£¼ì„¸ìš”.</div>
    </div>

    <script>
        const intersectionsElement = document.getElementById('intersections');
        const linesElement = document.getElementById('lines');
        const statusElement = document.getElementById('status');
        const boardWrapper = document.getElementById('board-wrapper');
        const difficultySelect = document.getElementById('difficulty');
        const modeButtons = document.querySelectorAll('#controls button[data-mode]');
        
        const BOARD_SIZE = 15; 
        let CELL_SIZE = 30; 

        let board = [];
        let currentPlayer = 1; 
        let gameOver = false;
        let currentMode = 'user-ai';
        let aiDepth = 3; 

        window.addEventListener('resize', () => {
             // ë¦¬ì‚¬ì´ì¦ˆ ì‹œ UI ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ê²Œì„ ì¬ì‹œì‘ (í¬ê¸° ì¬ê³„ì‚° í¬í•¨)
             if (!gameOver) startGame(); 
        });

        // -- ì´ˆê¸°í™” ë° UI ë¡œì§ (ì •ë ¬ ë¬¸ì œ í•´ê²°) --

        function initializeBoard() {
             // ë™ì ìœ¼ë¡œ CELL_SIZE ê³„ì‚°: wrapperì˜ ì‹¤ì œ í¬ê¸°ë¥¼ ì‚¬ìš© (padding ì œì™¸)
             const boardInnerWidth = boardWrapper.clientWidth - 30; // 30pxëŠ” íŒ¨ë”© (15*2)
             CELL_SIZE = boardInnerWidth / (BOARD_SIZE - 1);
             
             // Lines ë° Intersections ì»¨í…Œì´ë„ˆ í¬ê¸° ì„¤ì •
             const linesSize = (BOARD_SIZE - 1) * CELL_SIZE;
             linesElement.style.width = `${linesSize}px`;
             linesElement.style.height = `${linesSize}px`;
             intersectionsElement.style.width = `${linesSize}px`;
             intersectionsElement.style.height = `${linesSize}px`;

            board = Array(BOARD_SIZE).fill(0).map(() => Array(BOARD_SIZE).fill(0));
            linesElement.innerHTML = '';
            intersectionsElement.innerHTML = '';

            // 1. ì„  ê·¸ë¦¬ê¸° (Lines)
            for (let i = 0; i < BOARD_SIZE; i++) {
                // ê°€ë¡œì„ 
                const hLine = document.createElement('div');
                hLine.className = 'line-h';
                hLine.style.top = `${i * CELL_SIZE}px`; 
                linesElement.appendChild(hLine);

                // ì„¸ë¡œì„ 
                const vLine = document.createElement('div');
                vLine.className = 'line-v';
                vLine.style.left = `${i * CELL_SIZE}px`; 
                linesElement.appendChild(vLine);
            }

            // 2. êµì°¨ì (Intersection) ì˜ì—­ ì¶”ê°€ ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            for (let r = 0; r < BOARD_SIZE; r++) {
                for (let c = 0; c < BOARD_SIZE; c++) {
                    const intersection = document.createElement('div');
                    intersection.className = 'intersection';
                    
                    // ê° êµì°¨ì ì˜ ì •í™•í•œ ìœ„ì¹˜ ë° í¬ê¸°: CELL_SIZE í¬ê¸°ë¡œ ì„¤ì •í•˜ì—¬ í´ë¦­ ì˜ì—­ í™•ë³´
                    // ì´ ìœ„ì¹˜ëŠ” ì„ ì´ êµì°¨í•˜ëŠ” ì¤‘ì•™ì„ ê¸°ì¤€ìœ¼ë¡œ í•©ë‹ˆë‹¤.
                    intersection.style.top = `${r * CELL_SIZE}px`;
                    intersection.style.left = `${c * CELL_SIZE}px`;
                    intersection.style.width = `${CELL_SIZE}px`;
                    intersection.style.height = `${CELL_SIZE}px`;

                    intersection.dataset.row = r;
                    intersection.dataset.col = c;
                    
                    // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ ì¶”ê°€ (íˆ¬ëª… ëŒ í‘œì‹œ)
                    intersection.addEventListener('mouseover', showPreview);
                    intersection.addEventListener('mouseout', hidePreview);
                    
                    intersection.addEventListener('click', handleMove);
                    intersectionsElement.appendChild(intersection);
                }
            }
            gameOver = false;
        }

        // **[ìš”ì²­ 2] ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ íˆ¬ëª… ëŒ í‘œì‹œ ê¸°ëŠ¥**
        function showPreview(event) {
            if (gameOver || currentMode !== 'user-ai' || currentPlayer !== 1) return;
            
            const r = parseInt(event.target.dataset.row);
            const c = parseInt(event.target.dataset.col);
            
            if (board[r][c] === 0) {
                const intersection = event.target;
                
                // ì´ë¯¸ ëŒì´ ì—†ìœ¼ë©´ ë¯¸ë¦¬ë³´ê¸° ëŒ ìƒì„±
                if (intersection.querySelector('.stone') === null) {
                    const previewStone = document.createElement('div');
                    previewStone.className = 'stone black preview'; 
                    previewStone.style.width = `${CELL_SIZE * 0.9}px`;
                    previewStone.style.height = `${CELL_SIZE * 0.9}px`;
                    intersection.appendChild(previewStone);
                }
            }
        }

        function hidePreview(event) {
            const intersection = event.target;
            const previewStone = intersection.querySelector('.preview');
            if (previewStone) {
                intersection.removeChild(previewStone);
            }
        }


        modeButtons.forEach(button => {
            button.addEventListener('click', () => {
                modeButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                currentMode = button.dataset.mode;
                startGame();
            });
        });

        difficultySelect.addEventListener('change', () => {
            aiDepth = parseInt(difficultySelect.value);
        });

        function startGame() {
            aiDepth = parseInt(difficultySelect.value); 
            currentPlayer = 1; 
            initializeBoard();
            statusElement.textContent = 'í‘ëŒ ì°¨ë¡€ì…ë‹ˆë‹¤.';
            
            if (currentMode === 'ai-ai') {
                runAIGame();
            }
        }

        // -- ê²Œì„ íë¦„ ì œì–´ ë¡œì§ (íŒì—… ë° í„´ ë¡œì§ ìˆ˜ì •) --

        function handleMove(event) {
            if (gameOver || currentMode !== 'user-ai' || currentPlayer !== 1) return; 

            const r = parseInt(event.target.dataset.row);
            const c = parseInt(event.target.dataset.col);

            if (board[r][c] === 0) {
                 // **ë¯¸ë¦¬ë³´ê¸° ëŒì„ í™•ì¸ íŒì—… ì´ì „ì— ì œê±° (í´ë¦­ í›„ ë§ˆìš°ìŠ¤ ì•„ì›ƒ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ)**
                 hidePreview(event); 

                 if (!confirm(`(${r+1}, ${c+1}) ìœ„ì¹˜ì— í‘ëŒì„ ë†“ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?`)) { // ì‚¬ìš©ìê°€ ë” ì‰½ê²Œ ì´í•´í•˜ë„ë¡ +1 ì¢Œí‘œ í‘œì‹œ
                    return; 
                }

                placeStone(r, c, 1);
                
                // **[ìš”ì²­ 4] í„´ ì „í™˜ ë¡œì§ ìˆ˜ì •**
                if (!gameOver) {
                    statusElement.textContent = 'ë°±ëŒ (AI)ì´ ìƒê° ì¤‘...';
                    // AI í„´: ë¹„ë™ê¸° ì²˜ë¦¬
                    setTimeout(makeAIMove, 500); 
                }
            }
        }

        function placeStone(r, c, player) {
            board[r][c] = player;
            drawStoneOnUI(r, c, player);
            
            if (checkWin(r, c, player)) {
                const winner = player === 1 ? 'í‘ëŒ' : 'ë°±ëŒ';
                statusElement.textContent = `${winner} ìŠ¹ë¦¬! ğŸ‰`;
                gameOver = true;
            } else {
                // **í„´ ì „í™˜**
                currentPlayer = player === 1 ? 2 : 1; 
                
                // í„´ ìƒíƒœ UI ì—…ë°ì´íŠ¸
                if (currentMode !== 'ai-ai') {
                    const nextPlayer = currentPlayer === 1 ? 'í‘ëŒ' : 'ë°±ëŒ (AI)';
                    statusElement.textContent = `${nextPlayer} ì°¨ë¡€ì…ë‹ˆë‹¤.`;
                }
            }
        }
        
        function drawStoneOnUI(r, c, player) {
            const stone = document.createElement('div');
            stone.className = `stone ${player === 1 ? 'black' : 'white'}`;
            
            // ëŒ í¬ê¸°ë¥¼ ë™ì ìœ¼ë¡œ ì„¤ì •
            stone.style.width = `${CELL_SIZE * 0.9}px`;
            stone.style.height = `${CELL_SIZE * 0.9}px`;

            const index = r * BOARD_SIZE + c;
            const intersection = intersectionsElement.children[index];
            if (intersection && intersection.children.length === 0) {
                 intersection.appendChild(stone);
            }
        }

        function runAIGame() {
            if (gameOver) return;

            const thinkingPlayer = currentPlayer === 1 ? 'í‘ëŒ (AI)' : 'ë°±ëŒ (AI)';
            statusElement.textContent = `${thinkingPlayer}ì´ ìƒê° ì¤‘...`;
            
            setTimeout(() => {
                makeAIMove(true);
                if (!gameOver) {
                    runAIGame(); 
                }
            }, 500);
        }

        // -- AI ë¡œì§ (Minimax) --
        
        function makeAIMove(isAIVsAI = false) {
            if (gameOver) return;

            const aiPlayer = currentPlayer; 
            
            // ì„ì‹œ AI ë¡œì§ (Minimax í•¨ìˆ˜ ëŒ€ì‹  ëœë¤ ì„ íƒ ë˜ëŠ” ê°„ë‹¨í•œ ì²« ìˆ˜ ì¤‘ì•™ ì°©ìˆ˜)
            let bestMove = findBestMove(aiPlayer, aiDepth); 
            
            // ì²« ìˆ˜ ì¤‘ì•™ ì°©ìˆ˜ ë¡œì§ (AIê°€ í‘ì¼ ê²½ìš°)
            if (aiPlayer === 1 && board.flat().every(val => val === 0)) {
                bestMove = { r: 7, c: 7 }; 
            }
            // AIê°€ ë°±ì¼ ê²½ìš°, í‘ëŒ ì£¼ë³€ì— ì°©ìˆ˜í•˜ëŠ” ì„ì˜ ë¡œì§ (í˜„ì¬ Minimaxê°€ ì—†ìœ¼ë¯€ë¡œ)
            else if (aiPlayer === 2 && board[7][7] === 1 && board.flat().filter(val => val !== 0).length === 1) {
                bestMove = { r: 6, c: 7 }; // í‘ëŒ ë°”ë¡œ ìœ„ì— ì°©ìˆ˜
            }

            if (bestMove) {
                placeStone(bestMove.r, bestMove.c, aiPlayer);
            }
            
            if (isAIVsAI && !gameOver) {
                 const nextPlayer = currentPlayer === 1 ? 'í‘ëŒ' : 'ë°±ëŒ';
                 statusElement.textContent = `${nextPlayer} ì°¨ë¡€ì…ë‹ˆë‹¤.`;
            }
        }

        // --- Minimax ë° í‰ê°€ í•¨ìˆ˜ (ë”ë¯¸ í•¨ìˆ˜ ìœ ì§€) ---
        // ì´ ë¶€ë¶„ì€ ì‹¤ì œë¡œ AI ë¡œì§ì´ ë“¤ì–´ê°ˆ ìë¦¬ì…ë‹ˆë‹¤.
        function findBestMove(player, depth) { 
             const empty = [];
             for(let r=0; r<BOARD_SIZE; r++) {
                 for(let c=0; c<BOARD_SIZE; c++) {
                     if(board[r][c] === 0) empty.push({r, c});
                 }
             }
             if (empty.length > 0) {
                 return empty[Math.floor(Math.random() * empty.length)]; // ì„ì‹œ ëœë¤
             }
             return null;
        } 
        function checkWin(r, c, player) { /* ... */ return false; }
        // ... (ë‚˜ë¨¸ì§€ AI í•¨ìˆ˜ë“¤)

        window.onload = startGame;
    </script>
</body>
</html>