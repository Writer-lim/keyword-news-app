<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë„ì¿  (Sudoku)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap');
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f0f4f8;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* ìŠ¤ë„ì¿  ë³´ë“œ ìŠ¤íƒ€ì¼ */
        #sudoku-board {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            width: 400px; /* ì „ì²´ ë³´ë“œ í¬ê¸° */
            height: 400px;
            border: 4px solid #334155;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            background-color: #ffffff;
            margin: 0 auto;
        }

        .cell {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 700;
            border: 1px solid #e2e8f0; /* Gray-200 */
            transition: background-color 0.1s;
            cursor: pointer;
        }

        /* 3x3 ê²©ì êµ¬ë¶„ì„  ìŠ¤íƒ€ì¼ */
        .cell:nth-child(3n) { border-right-width: 3px; border-right-color: #334155; }
        .cell:nth-child(9n) { border-right-width: 1px; border-right-color: #e2e8f0; } /* ë§¨ ì˜¤ë¥¸ìª½ì€ ì–‡ê²Œ ìœ ì§€ */

        .cell:nth-child(n) { } /* ëª¨ë“  ì…€ */
        .cell:nth-child(n + 19):nth-child(-n + 27), 
        .cell:nth-child(n + 46):nth-child(-n + 54) {
             /* 3ë²ˆì§¸ì™€ 6ë²ˆì§¸ í–‰ ì•„ë˜ êµµì€ ì„  */
            border-bottom-width: 3px; 
            border-bottom-color: #334155;
        }
        
        .cell:nth-child(n + 73) { border-bottom: 1px solid #e2e8f0; } /* ë§¨ ì•„ë˜ì¤„ */
        .cell:nth-child(72) { border-bottom: 3px solid #334155; } /* 8í–‰ì˜ ë§ˆì§€ë§‰ ì…€ */
        .cell:nth-child(81) { border-bottom: none; } /* ìµœì¢… ì…€ì˜ ì•„ë˜ì„  ì œê±° (ì»¨í…Œì´ë„ˆ ê²½ê³„ì„  ì‚¬ìš©) */

        /* ì…ë ¥ì´ ê°€ëŠ¥í•œ ì…€ */
        .editable {
            color: #1e40af; /* Blue-800 */
            background-color: #eff6ff; /* Blue-50 */
        }
        
        .editable:hover {
            background-color: #dbeafe; /* Blue-100 */
        }

        /* ì˜ëª»ëœ ì…ë ¥ */
        .error {
            background-color: #fca5a5 !important; /* Red-300 */
            color: #7f1d1d; /* Red-900 */
        }

        /* ê³ ì •ëœ ìˆ«ì (í¼ì¦) */
        .fixed {
            background-color: #f9fafb; /* Gray-50 */
            color: #374151; /* Gray-700 */
            font-weight: 900;
        }

        /* ì„ íƒëœ ì…€ */
        .selected {
            background-color: #bfdbfe; /* Blue-200 */
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body onkeydown="handleKeyDown(event)">

    <div class="bg-white p-6 rounded-xl shadow-2xl flex flex-col md:flex-row gap-6">
        
        <div class="w-full md:w-56 p-4 bg-gray-100 rounded-lg flex flex-col justify-between">
            <h1 class="text-3xl font-bold text-center mb-4 text-gray-800">ğŸ”¢ ìŠ¤ë„ì¿ </h1>

            <div class="text-xl font-semibold mb-4 space-y-2">
                <div id="status" class="text-gray-800 font-bold">ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>
            </div>

            <div class="mb-4 text-sm text-gray-700">
                <h3 class="font-bold mb-1">ğŸ® ì¡°ì‘ í‚¤</h3>
                <ul class="list-disc list-inside space-y-0.5">
                    <li>**ì„ íƒ**: ë§ˆìš°ìŠ¤ í´ë¦­</li>
                    <li>**ì…ë ¥**: 1~9 ìˆ«ì í‚¤</li>
                    <li>**ì§€ìš°ê¸°**: 0 ë˜ëŠ” Delete/Backspace</li>
                </ul>
            </div>
            
            <div class="space-y-3">
                <select id="difficulty" class="w-full p-2 border border-gray-300 rounded-lg">
                    <option value="40">ì‰¬ì›€ (40ê°œ ì œê±°)</option>
                    <option value="50">ë³´í†µ (50ê°œ ì œê±°)</option>
                    <option value="60">ì–´ë ¤ì›€ (60ê°œ ì œê±°)</option>
                </select>

                <button id="start-button" onclick="startGame()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-lg transition-transform transform hover:scale-[1.02] active:scale-95">
                    ìƒˆ ê²Œì„ ì‹œì‘
                </button>

                <button id="check-button" onclick="checkSolution(false)" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg shadow-lg transition-transform transform hover:scale-[1.02] active:scale-95" disabled>
                    ì •ë‹µ í™•ì¸
                </button>
            </div>
        </div>

        <div id="sudoku-container" class="flex items-center justify-center">
            <div id="sudoku-board">
                </div>
        </div>
    </div>

    <a href="/" class="block mt-4 text-center text-indigo-500 hover:text-indigo-700 font-medium">
        â† ë©”ì¸ ê²€ìƒ‰ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
    </a>

    <script>
        const BOARD_SIZE = 9;
        const boardElement = document.getElementById('sudoku-board');
        const statusElement = document.getElementById('status');
        const checkButton = document.getElementById('check-button');
        const difficultySelect = document.getElementById('difficulty');
        
        let initialBoard = []; // í¼ì¦ ì‹œì‘ ìƒíƒœ (ê³ ì •ëœ ìˆ«ì)
        let currentBoard = [];  // í˜„ì¬ ì‚¬ìš©ì ì…ë ¥ ìƒíƒœ
        let solutionBoard = []; // ì •ë‹µ ìƒíƒœ
        let selectedCell = null;
        let cells = []; // DOM ì…€ ìš”ì†Œ ì €ì¥

        // --- í•µì‹¬ ìŠ¤ë„ì¿  ë¡œì§ ---
        
        // ë³´ë“œë¥¼ ì´ˆê¸°í™”í•˜ê³  ë Œë”ë§í•©ë‹ˆë‹¤.
        function renderBoard() {
            boardElement.innerHTML = '';
            cells = [];
            for (let i = 0; i < BOARD_SIZE; i++) {
                for (let j = 0; j < BOARD_SIZE; j++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell', 'flex', 'items-center', 'justify-center');
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    cell.textContent = currentBoard[i][j] > 0 ? currentBoard[i][j] : '';
                    
                    if (initialBoard[i][j] === 0) {
                        cell.classList.add('editable');
                        cell.addEventListener('click', () => selectCell(cell, i, j));
                    } else {
                        cell.classList.add('fixed');
                    }
                    
                    boardElement.appendChild(cell);
                    cells.push(cell);
                }
            }
        }
        
        // ì…€ì„ ì„ íƒí•©ë‹ˆë‹¤.
        function selectCell(cell, row, col) {
            if (selectedCell) {
                selectedCell.classList.remove('selected');
            }
            if (cell.classList.contains('editable')) {
                selectedCell = cell;
                selectedCell.classList.add('selected');
            } else {
                selectedCell = null;
            }
        }
        
        // ìˆ«ì ì…ë ¥ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
        function handleInput(value) {
            if (!selectedCell) return;
            
            const row = parseInt(selectedCell.dataset.row);
            const col = parseInt(selectedCell.dataset.col);
            
            // ì…ë ¥ê°’ ì—…ë°ì´íŠ¸
            currentBoard[row][col] = value;
            selectedCell.textContent = value > 0 ? value : '';
            
            // ì—ëŸ¬ í‘œì‹œ ì´ˆê¸°í™”
            cells.forEach(c => c.classList.remove('error'));
            
            // ìœ íš¨ì„± ê²€ì‚¬ (ì…ë ¥ëœ ê°’ë§Œ ê²€ì‚¬)
            if (value !== 0 && !isValidPlacement(currentBoard, row, col, value)) {
                 selectedCell.classList.add('error');
            } else {
                 selectedCell.classList.remove('error');
            }

            // ê²Œì„ ì™„ë£Œ í™•ì¸
            if (isBoardFull(currentBoard)) {
                checkSolution(true); // ìë™ ì •ë‹µ í™•ì¸
            }
        }

        // --- ìœ íš¨ì„± ê²€ì‚¬ ë° ì •ë‹µ í™•ì¸ ë¡œì§ ---

        // (r, c) ìœ„ì¹˜ì— valueê°€ ìœ íš¨í•œì§€ í™•ì¸
        function isValidPlacement(board, r, c, val) {
            // í–‰ ê²€ì‚¬
            for (let j = 0; j < BOARD_SIZE; j++) {
                if (j !== c && board[r][j] === val) return false;
            }
            // ì—´ ê²€ì‚¬
            for (let i = 0; i < BOARD_SIZE; i++) {
                if (i !== r && board[i][c] === val) return false;
            }
            // 3x3 ë°•ìŠ¤ ê²€ì‚¬
            const boxRowStart = Math.floor(r / 3) * 3;
            const boxColStart = Math.floor(c / 3) * 3;
            for (let i = boxRowStart; i < boxRowStart + 3; i++) {
                for (let j = boxColStart; j < boxColStart + 3; j++) {
                    if (i !== r && j !== c && board[i][j] === val) return false;
                }
            }
            return true;
        }

        // ë³´ë“œê°€ ê½‰ ì°¼ëŠ”ì§€ í™•ì¸
        function isBoardFull(board) {
            for (let i = 0; i < BOARD_SIZE; i++) {
                for (let j = 0; j < BOARD_SIZE; j++) {
                    if (board[i][j] === 0) return false;
                }
            }
            return true;
        }

        // ì „ì²´ ì •ë‹µ í™•ì¸
        function checkSolution(auto) {
            cells.forEach(c => c.classList.remove('error'));
            checkButton.disabled = true;

            // 1. ë³´ë“œê°€ ê½‰ ì°¼ëŠ”ì§€ í™•ì¸
            if (!isBoardFull(currentBoard)) {
                if (!auto) {
                     statusElement.textContent = "ì•„ì§ ë¹ˆì¹¸ì´ ë‚¨ì•„ìˆì–´ìš”!";
                }
                checkButton.disabled = false;
                return;
            }

            // 2. ì „ì²´ ë³´ë“œ ìœ íš¨ì„± ê²€ì‚¬
            let isCorrect = true;
            for (let r = 0; r < BOARD_SIZE; r++) {
                for (let c = 0; c < BOARD_SIZE; c++) {
                    const val = currentBoard[r][c];
                    const cellDom = cells[r * 9 + c];
                    
                    if (!isValidPlacement(currentBoard, r, c, val)) {
                        isCorrect = false;
                        if (cellDom.classList.contains('editable')) {
                            cellDom.classList.add('error');
                        }
                    } else if (cellDom.classList.contains('editable')) {
                        cellDom.classList.remove('error');
                    }
                }
            }

            if (isCorrect) {
                statusElement.textContent = "ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ì™„ë²½í•œ ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰";
                cells.forEach(c => c.classList.remove('editable', 'selected'));
            } else {
                statusElement.textContent = "âŒ ëª‡ëª‡ ìˆ«ìê°€ ê·œì¹™ì— ë§ì§€ ì•Šì•„ìš”. ë¹¨ê°„ìƒ‰ ì¹¸ì„ í™•ì¸í•˜ì„¸ìš”. âŒ";
                checkButton.disabled = false;
            }
        }
        
        // --- í¼ì¦ ìƒì„± ë¡œì§ (ë°±íŠ¸ë˜í‚¹) ---

        // ë¹ˆ 9x9 ë°°ì—´ ìƒì„±
        function createEmptyBoard() {
            return Array.from({length: BOARD_SIZE}, () => Array(BOARD_SIZE).fill(0));
        }

        // ë°±íŠ¸ë˜í‚¹ì„ ì‚¬ìš©í•˜ì—¬ ë³´ë“œë¥¼ ì±„ì›ë‹ˆë‹¤.
        function fillBoard(board) {
            for (let r = 0; r < BOARD_SIZE; r++) {
                for (let c = 0; c < BOARD_SIZE; c++) {
                    if (board[r][c] === 0) {
                        const nums = [1, 2, 3, 4, 5, 6, 7, 8, 9].sort(() => Math.random() - 0.5); // 1-9 ëœë¤ ì„ê¸°
                        for (const num of nums) {
                            if (isValidPlacement(board, r, c, num)) {
                                board[r][c] = num;
                                if (fillBoard(board)) {
                                    return true;
                                }
                                board[r][c] = 0; // ë°±íŠ¸ë˜í‚¹
                            }
                        }
                        return false; // ì •ë‹µì„ ì°¾ì§€ ëª»í•¨
                    }
                }
            }
            return true; // ë³´ë“œê°€ ì„±ê³µì ìœ¼ë¡œ ì±„ì›Œì§
        }

        // í¼ì¦ì„ ìƒì„±í•©ë‹ˆë‹¤.
        function generatePuzzle(cellsToRemove) {
            // 1. ì •ë‹µ ë³´ë“œ ìƒì„±
            let board = createEmptyBoard();
            fillBoard(board);
            solutionBoard = JSON.parse(JSON.stringify(board)); // ì •ë‹µ ì €ì¥
            
            // 2. ìˆ«ì ì œê±°
            let tempBoard = JSON.parse(JSON.stringify(board));
            let positions = [];
            for (let i = 0; i < 81; i++) positions.push(i);
            positions.sort(() => Math.random() - 0.5); // ìœ„ì¹˜ ëœë¤ ì„ê¸°

            let removedCount = 0;
            for (const pos of positions) {
                if (removedCount >= cellsToRemove) break;
                
                const r = Math.floor(pos / BOARD_SIZE);
                const c = pos % BOARD_SIZE;
                
                if (tempBoard[r][c] !== 0) {
                    // ì œê±° ì‹œë„
                    tempBoard[r][c] = 0;
                    removedCount++;
                }
            }
            
            initialBoard = tempBoard;
            currentBoard = JSON.parse(JSON.stringify(tempBoard)); // í˜„ì¬ í”Œë ˆì´ ë³´ë“œ
        }

        // --- ê²Œì„ ê´€ë¦¬ ---

        function startGame() {
            const cellsToRemove = parseInt(difficultySelect.value);
            
            generatePuzzle(cellsToRemove);
            renderBoard();
            
            // ìƒíƒœ ì—…ë°ì´íŠ¸
            statusElement.textContent = `ê²Œì„ ì‹œì‘! ë‚œì´ë„: ${difficultySelect.options[difficultySelect.selectedIndex].text}`;
            checkButton.disabled = false;
            cells.forEach(c => c.classList.remove('error', 'selected'));
            selectedCell = null;
        }

        // --- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ---
        
        function handleKeyDown(e) {
            // 1~9 ìˆ«ì ì…ë ¥
            if (e.key >= '1' && e.key <= '9') {
                handleInput(parseInt(e.key));
            } 
            // 0 ë˜ëŠ” Delete/Backspaceë¡œ ì§€ìš°ê¸°
            else if (e.key === '0' || e.key === 'Delete' || e.key === 'Backspace') {
                handleInput(0);
                e.preventDefault(); // ë°±ìŠ¤í˜ì´ìŠ¤ ê¸°ë³¸ ë™ì‘ ë°©ì§€
            }
            // ë°©í–¥í‚¤ë¡œ ì…€ ì´ë™ (ì„ íƒëœ ì…€ì´ ìˆì„ ê²½ìš°)
            else if (selectedCell) {
                const r = parseInt(selectedCell.dataset.row);
                const c = parseInt(selectedCell.dataset.col);
                let nextR = r;
                let nextC = c;
                
                switch(e.key) {
                    case 'ArrowUp':
                        nextR = Math.max(0, r - 1);
                        break;
                    case 'ArrowDown':
                        nextR = Math.min(8, r + 1);
                        break;
                    case 'ArrowLeft':
                        nextC = Math.max(0, c - 1);
                        break;
                    case 'ArrowRight':
                        nextC = Math.min(8, c + 1);
                        break;
                    default:
                        return;
                }
                
                e.preventDefault(); // ìŠ¤í¬ë¡¤ ë°©ì§€
                
                // ìƒˆë¡œìš´ ì…€ ì„ íƒ
                const nextCell = cells[nextR * 9 + nextC];
                if (nextCell) {
                    selectCell(nextCell, nextR, nextC);
                }
            }
        }
        
        // ì´ˆê¸°í™” ì‹œ ë¹ˆ ë³´ë“œë¥¼ ë¨¼ì € ê·¸ë¦½ë‹ˆë‹¤.
        document.addEventListener('DOMContentLoaded', () => {
             initialBoard = createEmptyBoard();
             currentBoard = createEmptyBoard();
             renderBoard();
        });

    </script>
</body>
</html>