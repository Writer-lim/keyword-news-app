<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë„ì¿  (Sudoku)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #e2e8f0; /* Blue Gray 200 */
        }
        
        /* ìŠ¤ë„ì¿  ë³´ë“œ ìŠ¤íƒ€ì¼ */
        .sudoku-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            grid-template-rows: repeat(9, 1fr);
            width: 100%;
            max-width: 500px;
            margin: auto;
            border: 4px solid #3b82f6; /* ë©”ì¸ í…Œë‘ë¦¬ */
        }

        .cell {
            aspect-ratio: 1 / 1; /* ì •ì‚¬ê°í˜• ìœ ì§€ */
            border: 1px solid #94a3b8; /* Light gray border (ì–‡ì€ ì„ ) */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            color: #1e293b;
            cursor: pointer;
            transition: background-color 0.1s;
            user-select: none;
            box-sizing: border-box; /* íŒ¨ë”©, í…Œë‘ë¦¬ê°€ í¬ê¸°ì— í¬í•¨ë˜ë„ë¡ */
        }

        /* --- 3x3 ë¸”ë¡ êµ¬ë¶„ì„  (ìˆ˜ì§ì„ ) ê°„ì†Œí™” --- */
        .cell:nth-child(3n) {
            border-right-width: 3px;
            border-right-color: #3b82f6;
        }
        /* 9ë²ˆì§¸ ì—´ (ë³´ë“œ ì˜¤ë¥¸ìª½ ë)ì˜ ì˜¤ë¥¸ìª½ ì„ ì€ ì–‡ê²Œ (ë©”ì¸ ë³´ë“œ í…Œë‘ë¦¬ê°€ ì²˜ë¦¬) */
        .cell:nth-child(9n) {
            border-right-width: 1px;
            border-right-color: #94a3b8;
        }
        
        /* --- 3x3 ë¸”ë¡ êµ¬ë¶„ì„  (ìˆ˜í‰ì„ ) ê°„ì†Œí™” --- */
        /* 27ë²ˆì§¸ ì…€ ì´í›„ (3í–‰, 6í–‰ ì•„ë˜)ì— êµµì€ í•˜ë‹¨ ì„ ì„ ì¶”ê°€ */
        /* grid-row-end: 4; (4ë²ˆì§¸ ê°€ë¡œì„ )ì— í•´ë‹¹í•˜ëŠ” ì…€ë“¤ */
        .cell[data-row="2"], .cell[data-row="5"] {
            border-bottom-width: 3px;
            border-bottom-color: #3b82f6;
        }
        /* ë§¨ ì•„ë˜ í–‰ì˜ í•˜ë‹¨ ì„ ì€ ì–‡ê²Œ (ë©”ì¸ ë³´ë“œ í…Œë‘ë¦¬ê°€ ì²˜ë¦¬) */
        .cell[data-row="8"] {
             border-bottom-width: 1px;
             border-bottom-color: #94a3b8;
        }
        /* ë§¨ ìœ„ í–‰ì˜ ìƒë‹¨ ì„ ì€ ì–‡ê²Œ */
        .cell[data-row="0"] {
            border-top-width: 1px;
            border-top-color: #94a3b8;
        }

        /* ì…€ ìƒíƒœ */
        .given {
            background-color: #eef2ff; /* Indigo 50: ì´ˆê¸°ê°’ */
            color: #1e293b;
            font-weight: 800;
            cursor: default;
        }
        .selected {
            background-color: #bfdbfe; /* Blue 300 */
        }
        .highlighted {
            background-color: #eff6ff; /* Blue 100: ê°™ì€ í–‰/ì—´/ë¸”ë¡ */
        }
        .wrong {
            color: #ef4444; /* Red 500: ì˜¤ë‹µ */
        }
        .cell:not(.given):hover {
            background-color: #dbeafe; /* Blue 200: ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ìƒ‰ìƒë§Œ ë³€ê²½ */
        }
        
        /* í‚¤ë³´ë“œ ì…ë ¥ í•„ë“œ ìˆ¨ê¸°ê¸° */
        #input-key {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body class="p-4 md:p-8 flex flex-col items-center justify-center min-h-screen">

    <div class="bg-white p-6 md:p-10 rounded-xl shadow-2xl flex flex-col lg:flex-row gap-8 max-w-5xl w-full">
        
        <div class="lg:w-1/3 space-y-6">
            <h1 class="text-3xl font-extrabold text-gray-900 flex items-center">
                <i class="fas fa-calculator mr-3 text-indigo-500"></i> ìŠ¤ë„ì¿ 
            </h1>
            
            <div>
                <label for="difficulty" class="block text-sm font-medium text-gray-700 mb-1">ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”.</label>
                <select id="difficulty" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-base">
                    <option value="easy">ì‰¬ì›€ (40ê°œ ì œê±°)</option>
                    <option value="medium">ë³´í†µ (50ê°œ ì œê±°)</option>
                    <option value="hard">ì–´ë ¤ì›€ (60ê°œ ì œê±°)</option>
                </select>
            </div>
            
            <button id="new-game-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg shadow-lg transition-colors">
                ìƒˆ ê²Œì„ ì‹œì‘
            </button>
            <button id="check-solution-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg shadow-lg transition-colors disabled:opacity-50" disabled>
                ì •ë‹µ í™•ì¸
            </button>
            <button id="solve-btn" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 rounded-lg shadow-lg transition-colors">
                ìë™ í’€ì´ (íŒíŠ¸)
            </button>

            <div id="message-area" class="text-center font-semibold pt-4">
                <p class="text-gray-500">ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”.</p>
            </div>
        </div>

        <div class="lg:w-2/3 flex flex-col items-center justify-center">
            <div id="sudoku-board" class="sudoku-grid w-full">
                </div>
            <p class="text-sm text-gray-500 mt-4">
                ì¡°ì‘: ë§ˆìš°ìŠ¤ í´ë¦­ ë˜ëŠ” í™”ì‚´í‘œ í‚¤ë¡œ ì´ë™ í›„, 1-9 ìˆ«ì í‚¤ë¡œ ì…ë ¥
            </p>
        </div>
    </div>

    <a href="/" class="text-indigo-500 hover:text-indigo-700 mt-8 text-lg block transition-colors">
        &larr; ë©”ì¸ ê²€ìƒ‰ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
    </a>

    <input type="text" id="input-key">

    <script>
        // --- 1. ìŠ¤ë„ì¿  ê²Œì„ ë°ì´í„° ë° ìƒíƒœ ê´€ë¦¬ ---
        let board = [];
        let solution = [];
        let difficulty = 'easy';
        let selectedCell = null;
        
        const BOARD_SIZE = 9;
        const boardElement = document.getElementById('sudoku-board');
        const messageArea = document.getElementById('message-area');
        const inputKey = document.getElementById('input-key');

        // ìŠ¤ë„ì¿  í¼ì¦ ìƒì„± í•¨ìˆ˜ (ê°„ë‹¨í™”ëœ ì˜ˆì‹œ, ì‹¤ì œ ë³µì¡í•œ ìƒì„± ë¡œì§ì€ ìƒëµ)
        function generatePuzzle(level) {
            // (ì‹¤ì œ ìŠ¤ë„ì¿  ìƒì„± ë¡œì§ì´ ì—¬ê¸°ì— ë“¤ì–´ê°‘ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ìš© ë³´ë“œë§Œ ì œê³µí•©ë‹ˆë‹¤.)
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ë°±íŠ¸ë˜í‚¹ ë“±ì„ í†µí•´ ìœ íš¨í•œ ìŠ¤ë„ì¿ ë¥¼ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.
            
            solution = [
                [5,3,4,6,7,8,9,1,2],
                [6,7,2,1,9,5,3,4,8],
                [1,9,8,3,4,2,5,6,7],
                [8,5,9,7,6,1,4,2,3],
                [4,2,6,8,5,3,7,9,1],
                [7,1,3,9,2,4,8,5,6],
                [9,6,1,5,3,7,2,8,4],
                [2,8,7,4,1,9,6,3,5],
                [3,4,5,2,8,6,1,7,9]
            ];
            
            // ë‚œì´ë„ì— ë”°ë¼ ì…€ì„ ì œê±°í•©ë‹ˆë‹¤.
            let cellsToRemove = { 'easy': 40, 'medium': 50, 'hard': 60 }[level];
            board = solution.map(arr => [...arr]); // solution ë³µì‚¬
            
            let count = 0;
            while (count < cellsToRemove) {
                const r = Math.floor(Math.random() * BOARD_SIZE);
                const c = Math.floor(Math.random() * BOARD_SIZE);
                
                if (board[r][c] !== 0) {
                    board[r][c] = 0;
                    count++;
                }
            }
            return { board, solution };
        }

        // --- 2. ë Œë”ë§ ë° UI ì¡°ì‘ ---
        
        function renderBoard() {
            boardElement.innerHTML = '';
            for (let r = 0; r < BOARD_SIZE; r++) {
                for (let c = 0; c < BOARD_SIZE; c++) {
                    const cellValue = board[r][c];
                    const cellDiv = document.createElement('div');
                    
                    cellDiv.classList.add('cell');
                    cellDiv.dataset.row = r; // data-row ì†ì„±ì„ ì‚¬ìš©í•˜ì—¬ êµµì€ ìˆ˜í‰ì„  ì²˜ë¦¬
                    cellDiv.dataset.col = c;
                    cellDiv.textContent = cellValue !== 0 ? cellValue : '';
                    
                    if (cellValue !== 0) {
                        cellDiv.classList.add('given');
                    } else {
                        cellDiv.addEventListener('click', selectCell);
                    }
                    
                    boardElement.appendChild(cellDiv);
                }
            }
            clearSelection();
        }

        function clearSelection() {
            document.querySelectorAll('.cell').forEach(cell => {
                cell.classList.remove('selected', 'highlighted', 'wrong');
            });
            selectedCell = null;
        }

        function selectCell(event) {
            clearSelection();
            
            const cell = event.currentTarget || event;
            if (cell.classList.contains('given')) return;
            
            selectedCell = cell;
            selectedCell.classList.add('selected');
            
            // í•˜ì´ë¼ì´íŠ¸ ì ìš© (ê°™ì€ í–‰, ì—´, ë¸”ë¡)
            const r = parseInt(cell.dataset.row);
            const c = parseInt(cell.dataset.col);
            highlightRelatedCells(r, c);

            // í‚¤ë³´ë“œ ì…ë ¥ì„ ë°›ì„ ìˆ˜ ìˆë„ë¡ ìˆ¨ê²¨ì§„ input í•„ë“œì— í¬ì»¤ìŠ¤
            inputKey.focus();
        }
        
        function highlightRelatedCells(r, c) {
            const startRow = r - (r % 3);
            const startCol = c - (c % 3);
            
            document.querySelectorAll('.cell').forEach(cell => {
                const cellR = parseInt(cell.dataset.row);
                const cellC = parseInt(cell.dataset.col);
                
                // ê°™ì€ í–‰ ë˜ëŠ” ì—´
                if (cellR === r || cellC === c) {
                    cell.classList.add('highlighted');
                }
                
                // ê°™ì€ 3x3 ë¸”ë¡
                if (Math.floor(cellR / 3) * 3 === startRow && Math.floor(cellC / 3) * 3 === startCol) {
                    cell.classList.add('highlighted');
                }
            });
        }
        
        // --- 3. ê²Œì„ ë¡œì§ ë° ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ---
        
        function handleInput(value) {
            if (!selectedCell || selectedCell.classList.contains('given')) return;
            
            const r = parseInt(selectedCell.dataset.row);
            const c = parseInt(selectedCell.dataset.col);
            
            // ì…ë ¥ (1-9)
            if (value >= 1 && value <= 9) {
                selectedCell.textContent = value;
                board[r][c] = value;
            } 
            // ì§€ìš°ê¸° (0 ë˜ëŠ” Delete/Backspace)
            else if (value === 0) {
                selectedCell.textContent = '';
                board[r][c] = 0;
            }
            
            // ì…ë ¥ í›„ ë‹¤ìŒ ì…€ë¡œ ì´ë™ (ì„ íƒì ìœ¼ë¡œ)
            // moveSelection(1); // ìë™ ì´ë™ ì£¼ì„ ì²˜ë¦¬
        }

        function moveSelection(direction) { // 1: ë‹¤ìŒ, -1: ì´ì „, 9: ì•„ë˜, -9: ìœ„
            if (!selectedCell) return;
            
            const r = parseInt(selectedCell.dataset.row);
            const c = parseInt(selectedCell.dataset.col);
            let nextIndex = r * BOARD_SIZE + c + direction;

            const totalCells = BOARD_SIZE * BOARD_SIZE;

            // ë‹¤ìŒ ì¸ë±ìŠ¤ ê³„ì‚° ë° ê²½ê³„ ì²˜ë¦¬
            if (direction === 1 && c === BOARD_SIZE - 1) { // ì˜¤ë¥¸ìª½ ëì—ì„œ ë‹¤ìŒìœ¼ë¡œ
                nextIndex = (r < BOARD_SIZE - 1) ? (r + 1) * BOARD_SIZE : 0;
            } else if (direction === -1 && c === 0) { // ì™¼ìª½ ëì—ì„œ ì´ì „ìœ¼ë¡œ
                nextIndex = (r > 0) ? r * BOARD_SIZE - 1 : totalCells - 1;
            } else if (direction === BOARD_SIZE || direction === -BOARD_SIZE) { // ìƒí•˜ ì´ë™ì€ ëª¨ë“ˆë¡œ ì²˜ë¦¬
                nextIndex = (nextIndex + totalCells) % totalCells;
            } else {
                 nextIndex = (nextIndex + totalCells) % totalCells;
            }
            
            const nextCell = boardElement.children[nextIndex];

            // ì£¼ì–´ì§„ ì…€(given) ê±´ë„ˆë›°ê¸° ë¡œì§
            if (nextCell.classList.contains('given')) {
                // ì£¼ì–´ì§„ ì…€ì„ ê±´ë„ˆë›°ë©´ì„œ ë‹¤ìŒ/ì´ì „ ì…€ë¡œ ì´ë™ ì‹œë„
                const maxAttempts = totalCells;
                for (let i = 0; i < maxAttempts; i++) {
                    nextIndex = (nextIndex + direction + totalCells) % totalCells;
                    const trialCell = boardElement.children[nextIndex];
                    if (!trialCell.classList.contains('given')) {
                        selectCell(trialCell);
                        return;
                    }
                }
                return; // ëª¨ë“  ì…€ì´ givenì¸ ê²½ìš°
            }

            selectCell(nextCell);
        }


        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        inputKey.addEventListener('keydown', (e) => {
            e.preventDefault(); // ê¸°ë³¸ í‚¤ë³´ë“œ ë™ì‘ ë°©ì§€

            if (!selectedCell) return;
            
            const keyCode = e.key;

            if (keyCode >= '1' && keyCode <= '9') {
                handleInput(parseInt(keyCode));
            } else if (keyCode === 'Delete' || keyCode === 'Backspace' || keyCode === '0') {
                handleInput(0);
            } else if (keyCode === 'ArrowRight') {
                moveSelection(1);
            } else if (keyCode === 'ArrowLeft') {
                moveSelection(-1);
            } else if (keyCode === 'ArrowUp') {
                moveSelection(-BOARD_SIZE);
            } else if (keyCode === 'ArrowDown') {
                moveSelection(BOARD_SIZE);
            }
            
            // ì—”í„°, ìŠ¤í˜ì´ìŠ¤, íƒ­ ë“±ì„ í†µí•œ ì´ë™ ë°©ì§€ (ë°©í–¥í‚¤ë§Œ ì‚¬ìš©)
            else if (keyCode === ' ' || keyCode === 'Tab' || keyCode === 'Enter') {
                // ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
            }
        });
        
        // ì •ë‹µ í™•ì¸ ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬
        document.getElementById('check-solution-btn').addEventListener('click', () => {
            let correctCount = 0;
            let wrongCount = 0;
            
            document.querySelectorAll('.cell').forEach(cell => {
                const r = parseInt(cell.dataset.row);
                const c = parseInt(cell.dataset.col);
                const currentValue = parseInt(cell.textContent) || 0;
                
                cell.classList.remove('wrong');

                if (currentValue !== 0 && !cell.classList.contains('given')) {
                    if (currentValue === solution[r][c]) {
                        correctCount++;
                    } else {
                        cell.classList.add('wrong');
                        wrongCount++;
                    }
                }
            });

            if (wrongCount === 0 && document.querySelectorAll('.cell:not(.given)').length === correctCount) {
                messageArea.innerHTML = `<p class="text-green-600">ğŸ‰ **ì •ë‹µì…ë‹ˆë‹¤!** ì™„ë²½í•˜ê²Œ ìŠ¤ë„ì¿ ë¥¼ ì™„ì„±í–ˆì–´ìš”!</p>`;
            } else if (wrongCount > 0) {
                messageArea.innerHTML = `<p class="text-red-600">âŒ **${wrongCount}ê°œ**ì˜ í‹€ë¦° ë¶€ë¶„ì´ ìˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ í™•ì¸í•´ë³´ì„¸ìš”.</p>`;
            } else {
                messageArea.innerHTML = `<p class="text-blue-600">ê³„ì† í’€ì´í•´ ë³´ì„¸ìš”!</p>`;
            }
        });

        // ìë™ í’€ì´ (íŒíŠ¸) ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬
        document.getElementById('solve-btn').addEventListener('click', () => {
            if (!solution || boardElement.children.length === 0) {
                messageArea.innerHTML = `<p class="text-red-500">ìƒˆ ê²Œì„ì„ ë¨¼ì € ì‹œì‘í•˜ì„¸ìš”.</p>`;
                return;
            }
            
            const cellsToFill = document.querySelectorAll('.cell:not(.given)');
            if (cellsToFill.length === 0) return;
            
            const cell = cellsToFill[Math.floor(Math.random() * cellsToFill.length)];
            const r = parseInt(cell.dataset.row);
            const c = parseInt(cell.dataset.col);
            
            // íŒíŠ¸ë¥¼ ì œê³µí•  ë•Œ ì •ë‹µì„ ì…ë ¥í•˜ê³  ë°”ë¡œ ì£¼ì–´ì§„ ì…€ì²˜ëŸ¼ ì²˜ë¦¬
            cell.textContent = solution[r][c];
            board[r][c] = solution[r][c];
            cell.classList.add('given'); // íŒíŠ¸ ì…€ì€ ë‹¤ì‹œ ë³€ê²½ ë¶ˆê°€ëŠ¥í•˜ë„ë¡ given ì²˜ë¦¬
            cell.classList.remove('wrong', 'highlighted', 'selected');
            
            // ì…ë ¥ í›„ ì„ íƒ í•´ì œ
            selectedCell = null;
            clearSelection();
            
            messageArea.innerHTML = `<p class="text-orange-500">ğŸ’¡ íŒíŠ¸: í•œ ì¹¸ì„ ì±„ì› ìŠµë‹ˆë‹¤. (ì´ì œ ìˆ˜ì • ë¶ˆê°€)</p>`;
            
            // ëª¨ë“  ì…€ì´ ì±„ì›Œì¡ŒëŠ”ì§€ ë‹¤ì‹œ í™•ì¸
            document.getElementById('check-solution-btn').click();
        });


        // ìƒˆ ê²Œì„ ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬
        document.getElementById('new-game-btn').addEventListener('click', () => {
            difficulty = document.getElementById('difficulty').value;
            generatePuzzle(difficulty);
            renderBoard();
            document.getElementById('check-solution-btn').disabled = false;
            messageArea.innerHTML = `<p class="text-gray-500">ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”! ë‚œì´ë„: ${difficulty}</p>`;
        });

        // ì´ˆê¸° ì‹œì‘
        document.addEventListener('DOMContentLoaded', () => {
            // ì´ˆê¸° ë‚œì´ë„ë¡œ í¼ì¦ ìƒì„± ë° ë Œë”ë§
            document.getElementById('new-game-btn').click(); 
        });

    </script>
</body>
</html>